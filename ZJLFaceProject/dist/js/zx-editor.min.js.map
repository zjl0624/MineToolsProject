{"version":3,"file":"zx-editor.min.js","sources":["../../node_modules/_ssr-window@1.0.1@ssr-window/dist/ssr-window.esm.js","../../src/js/dom-class/helper.js","../../src/js/util/index.js","../../src/js/dom-class/index.js","../../src/js/cursor-class/index.js","../../src/js/expansion-panel/index.js","../../src/js/plugins/text-style/helper.js","../../src/js/config.js","../../src/js/plugins/text-style/style-expansion-panel.js","../../src/js/plugins/text-style/index.js","../../src/js/plugins/select-picture-btn/index.js","../../src/js/toolbar/index.js","../../src/js/events/paste.js","../../src/js/custom-events/index.js","../../src/js/image-handler/helper.js","../../src/js/image-handler/index.js","../../src/js/index.js","../../src/js/init/extend-prototype.js","../../src/js/init/init-dom.js","../../src/js/init/init-style.js","../../src/js/events/index.js"],"sourcesContent":["/**\n * SSR Window 1.0.1\n * Better handling for window object in SSR environment\n * https://github.com/nolimits4web/ssr-window\n *\n * Copyright 2018, Vladimir Kharlampidi\n *\n * Licensed under MIT\n *\n * Released on: July 18, 2018\n */\nvar doc = (typeof document === 'undefined') ? {\n  body: {},\n  addEventListener: function addEventListener() {},\n  removeEventListener: function removeEventListener() {},\n  activeElement: {\n    blur: function blur() {},\n    nodeName: '',\n  },\n  querySelector: function querySelector() {\n    return null;\n  },\n  querySelectorAll: function querySelectorAll() {\n    return [];\n  },\n  getElementById: function getElementById() {\n    return null;\n  },\n  createEvent: function createEvent() {\n    return {\n      initEvent: function initEvent() {},\n    };\n  },\n  createElement: function createElement() {\n    return {\n      children: [],\n      childNodes: [],\n      style: {},\n      setAttribute: function setAttribute() {},\n      getElementsByTagName: function getElementsByTagName() {\n        return [];\n      },\n    };\n  },\n  location: { hash: '' },\n} : document; // eslint-disable-line\n\nvar win = (typeof window === 'undefined') ? {\n  document: doc,\n  navigator: {\n    userAgent: '',\n  },\n  location: {},\n  history: {},\n  CustomEvent: function CustomEvent() {\n    return this;\n  },\n  addEventListener: function addEventListener() {},\n  removeEventListener: function removeEventListener() {},\n  getComputedStyle: function getComputedStyle() {\n    return {\n      getPropertyValue: function getPropertyValue() {\n        return '';\n      },\n    };\n  },\n  Image: function Image() {},\n  Date: function Date() {},\n  screen: {},\n  setTimeout: function setTimeout() {},\n  clearTimeout: function clearTimeout() {},\n} : window; // eslint-disable-line\n\nexport { win as window, doc as document };\n","/**\r\n * Created by Capricorncd.\r\n * User: https://github.com/capricorncd\r\n * Date: 2019/04/18 22:57\r\n */\r\nimport util from '../util/index'\r\nimport { document } from 'ssr-window'\r\n\r\n/**\r\n * unique\r\n * Remove duplicate elements in an array\r\n * @param arr\r\n * @return {Array}\r\n */\r\nexport function unique (arr) {\r\n  const uniqueArray = []\r\n  for (let i = 0; i < arr.length; i += 1) {\r\n    if (uniqueArray.indexOf(arr[i]) === -1) uniqueArray.push(arr[i])\r\n  }\r\n  return uniqueArray\r\n}\r\n\r\n/**\r\n * 改变元素的nodeName\r\n * @param oldNode\r\n * @param tagName target nodeName\r\n * @return {*}\r\n */\r\nexport function changeNodeName (oldNode, tagName) {\r\n  let oldNodeName = oldNode.nodeName.toLowerCase()\r\n  // check tagName\r\n  if (typeof tagName !== 'string' || util.strip(tagName).length === 0) {\r\n    throw new TypeError(`changeNodeName(oldNode, tagName) 'tagName' is ${tagName}, should be a 'string'`)\r\n  }\r\n  if (oldNodeName === tagName.toLowerCase()) return oldNode\r\n  let el = document.createElement(tagName)\r\n  // 非Element节点，当字符串节点处理\r\n  if (oldNode.nodeType !== 1) {\r\n    el.appendChild(oldNode)\r\n  } else {\r\n   // 获取属性class, style, id\r\n    if (oldNode.className) el.className = oldNode.className\r\n    if (oldNode.id) el.id = oldNode.id\r\n    let style = oldNode.getAttribute('style')\r\n    if (style) el.setAttribute('style', style)\r\n    el.innerHTML = oldNode.innerHTML\r\n  }\r\n  // replace Node on document\r\n  if (oldNode.parentNode) {\r\n    oldNode.parentNode.replaceChild(el, oldNode)\r\n  }\r\n  return el\r\n}\r\n\r\n/**\r\n * addEventListener\r\n * @param el\r\n * @param eventType\r\n * @param fn\r\n * @param useCapture\r\n */\r\nexport function addEventListener (el, eventType, fn, useCapture) {\r\n  if (el.addEventListener) {\r\n    el.addEventListener(eventType, fn, useCapture)\r\n  } else if (el.attachEvent) {\r\n    el.attachEvent(eventType, fn)\r\n  } else {\r\n    el[`on${eventType}`] = fn\r\n  }\r\n}\r\n\r\n/**\r\n * removeEventListener\r\n * @param el\r\n * @param eventType\r\n * @param fn\r\n * @param useCapture\r\n */\r\nexport function removeEventListener (el, eventType, fn, useCapture) {\r\n  if (el.removeEventListener) {\r\n    el.removeEventListener(eventType, fn, useCapture)\r\n  } else if (el.detachEvent) {\r\n    el.detachEvent(eventType, fn)\r\n  } else {\r\n    el[`on${eventType}`] = null\r\n  }\r\n}\r\n\r\n/**\r\n * crate text node\r\n * @param str\r\n * @return {Text | ActiveX.IXMLDOMText}\r\n */\r\nfunction createTextNode (str) {\r\n  return document.createTextNode(str)\r\n}\r\n\r\n/**\r\n * create element\r\n * @param tag HTML tag name\r\n * @param attrs attributes\r\n * @return {*|{children, childNodes, style, setAttribute, getElementsByTagName}|ActiveX.IXMLDOMElement|HTMLElement}\r\n */\r\nexport function createElement (tag, attrs) {\r\n  if (!tag && typeof tag !== 'string') {\r\n    throw new TypeError('Parameter error')\r\n  }\r\n  let el = document.createElement(tag)\r\n  if (attrs && typeof attrs === 'object') {\r\n    for (let key in attrs) {\r\n      if (attrs.hasOwnProperty(key)) {\r\n        el.setAttribute(key, attrs[key])\r\n      }\r\n    }\r\n  }\r\n  return el\r\n}\r\n\r\n/**\r\n * create dom\r\n * @param vnode {tag: 'div', attrs: {class: 'class-name', 'data-id': 1000}, child: ['any text', vnode]}\r\n * @return {*}\r\n */\r\nexport function createVdom (vnode) {\r\n  if (!vnode) return null\r\n  if (typeof vnode === 'string') {\r\n    return createTextNode(vnode)\r\n  }\r\n  let tag = vnode.tag\r\n  let attrs = vnode.attrs\r\n  let child = vnode.child\r\n  if (!tag && !attrs && !child) return null\r\n  // 创建dom\r\n  let el = createElement(tag || 'div', attrs)\r\n  if (Array.isArray(child) && child.length) {\r\n    let itemNode\r\n    child.forEach(item => {\r\n      itemNode = createVdom(item)\r\n      if (itemNode) el.appendChild(itemNode)\r\n    })\r\n  } else if (child && typeof child === 'string') {\r\n    el.appendChild(createTextNode(child))\r\n  }\r\n  return el\r\n}\r\n\r\n","/**\r\n * Created by Capricorncd.\r\n * Date: 2019/04/15 13:16\r\n * Copyright © 2017-present, https://github.com/capricorncd\r\n */\r\nimport { document, window } from 'ssr-window'\r\nimport {\r\n  changeNodeName,\r\n  unique\r\n} from '../dom-class/helper'\r\n\r\nconst arr = []\r\n\r\n// Support: Android <=4.0 only\r\n// Make sure we trim BOM and NBSP\r\nconst regTrim = /^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g\r\n\r\n// navigator\r\nconst USER_AGENT = window.navigator.userAgent\r\nconst PLATFORM = window.navigator.platform\r\n\r\n/**\r\n * 转换为整数\r\n * @param n\r\n * @returns {*}\r\n */\r\nfunction int (n) {\r\n  let num = parseInt(n)\r\n  return isNaN(num) ? 0 : num\r\n}\r\n\r\n/**\r\n * 去除字符串首尾空格\r\n * @param str\r\n * @returns {string}\r\n */\r\nfunction trim (str) {\r\n  return str ? str.toString().replace(regTrim, '') : ''\r\n}\r\n\r\n/**\r\n * 将伪数组，转化为数组\r\n * @param ArrayLike\r\n * @param index\r\n * @return {T[]}\r\n */\r\nfunction slice (ArrayLike, index) {\r\n  return arr.slice.call(ArrayLike, int(index))\r\n}\r\n\r\n/**\r\n * 去除字符串多余空格\r\n * 除首尾外，中间连续空格被替换为一个空格\r\n * @param str\r\n * @return {string}\r\n */\r\nfunction strip (str) {\r\n  return trim(str).replace(/\\s+/g, ' ')\r\n}\r\n\r\n/**\r\n * 是否为Element对象\r\n * @param el\r\n * @return {*|boolean}\r\n */\r\nfunction isElement (el) {\r\n  return isObject(el) && el.nodeType\r\n}\r\n\r\n/**\r\n * 是否为对象\r\n * @param obj\r\n * @param isAbsolute 必须满足父级原型为Object的对象\r\n * @return {*|boolean}\r\n */\r\nfunction isObject (obj, isAbsolute) {\r\n  let isObj = obj && typeof obj === 'object'\r\n  return isAbsolute ? isObj && obj.toString() === '[object Object]' : isObj\r\n}\r\n\r\nfunction isIPhone () {\r\n  return /iphone/i.test(USER_AGENT) && /iphone/.test(PLATFORM)\r\n}\r\n\r\nfunction isIPhoneX () {\r\n  return window.screen.height === 812 && window.screen.width === 375\r\n}\r\n\r\nfunction isWindow (obj) {\r\n  return obj !== null && obj === obj.window\r\n}\r\n\r\n/**\r\n * 移除html标签\r\n * @param str\r\n * @return {string}\r\n */\r\nfunction removeHtmlTags (str) {\r\n  str = (str + '').replace(/<\\/?.+?>/g, '')\r\n  return strip(str)\r\n}\r\n\r\nfunction toHex (num) {\r\n  let n = typeof num === 'number' ? num : int(num)\r\n  let hex = n.toString(16)\r\n  return hex[1] ? hex : '0' + hex\r\n}\r\n\r\nfunction rgbToHex (rgb) {\r\n  let hex = ''\r\n  if (/rgb.*?\\((\\d+)\\D+?(\\d+)\\D+?(\\d+)/.test(rgb)) {\r\n    hex += toHex(RegExp.$1)\r\n    hex += toHex(RegExp.$2)\r\n    hex += toHex(RegExp.$3)\r\n  }\r\n  return hex ? '#' + hex : rgb\r\n}\r\n\r\n/**\r\n * string to hump format\r\n * @param str line-height: lineHeight\r\n * @return {string}\r\n */\r\nfunction toHump (str) {\r\n  return strip(str).replace(/([-_\\s]+\\w)/g, (match, $1) => {\r\n    // console.log(match, $1)\r\n    return $1[1].toUpperCase()\r\n  })\r\n}\r\n\r\nfunction supportBoxModel () {\r\n  const body = document.getElementsByTagName('body')[0]\r\n  let div = document.createElement('div')\r\n  body.appendChild(div)\r\n  // Figure out if the W3C box model works as expected\r\n  div.innerHTML = ''\r\n  div.style.width = div.style.paddingLeft = '1px'\r\n  // 通过检测div块的offsetWidth值是否是2px来判断浏览器是否支持盒模型\r\n  let result = div.offsetWidth === 2\r\n  body.removeChild(div)\r\n  return result\r\n}\r\n\r\nexport default {\r\n  isIPhone: isIPhone(),\r\n  isIPhoneX: isIPhoneX(),\r\n  supportBoxModel: supportBoxModel(),\r\n  changeNodeName,\r\n  int,\r\n  isElement,\r\n  isObject,\r\n  isWindow,\r\n  removeHtmlTags,\r\n  rgbToHex,\r\n  slice,\r\n  strip,\r\n  trim,\r\n  toHump,\r\n  unique\r\n}\r\n","/**\r\n * Created by Capricorncd.\r\n * User: https://github.com/capricorncd\r\n * Date: 2019/04/17 20:36\r\n */\r\nimport util from '../util/index'\r\nimport { document, window } from 'ssr-window'\r\nimport { unique, changeNodeName, addEventListener, removeEventListener } from './helper'\r\n\r\n/**\r\n * DOM操作\r\n * @param selector\r\n * @param context\r\n * @constructor\r\n */\r\nexport function ZxQuery (selector, context) {\r\n\r\n  // HANDLE: $(\"\"), $(null), $(undefined), $(false)\r\n  if ( !selector ) return this\r\n\r\n  if (selector instanceof ZxQuery) return selector\r\n\r\n  let doms\r\n\r\n  // Handle HTML strings\r\n  if ( typeof selector === 'string' ) {\r\n    if ( selector[ 0 ] === '<' &&\r\n      selector[ selector.length - 1 ] === '>' && selector.length >= 3 ) {\r\n\r\n      // Assume that strings that start and end with <> are HTML and skip the regex check\r\n      let tempDiv = document.createElement('div')\r\n      tempDiv.innerHTML = selector\r\n      doms = util.slice(tempDiv.childNodes)\r\n    } else if (/^[#\\w\\d_,\\s-]+$/.test(selector)) {\r\n      if (context instanceof ZxQuery) {\r\n        context =  context[0]\r\n      }\r\n      context = util.isElement(context) && context.nodeType === 1 ? context : document\r\n      doms = util.slice(context.querySelectorAll(util.strip(selector)))\r\n    }\r\n    // HANDLE: $(DOMElement)\r\n  } else if ( selector.nodeType || selector === window || selector === document ) {\r\n    doms = [selector]\r\n    // HANDLE: $(DOMElements)\r\n  } else if (Array.isArray(selector) && selector.every(item => util.isElement(item))) {\r\n    doms = selector\r\n  }\r\n\r\n  if (doms) {\r\n    doms.forEach((el, i) => {\r\n      this[i] = el\r\n    })\r\n    this.length = doms.length\r\n  }\r\n  return this\r\n}\r\n\r\n/**\r\n * prototype\r\n */\r\nZxQuery.prototype = {\r\n  /**\r\n   * constructor\r\n   */\r\n  constructor: ZxQuery,\r\n\r\n  /**\r\n   * length\r\n   */\r\n  length: 0,\r\n\r\n  /**\r\n   * ********************************************\r\n   * find item\r\n   * ********************************************\r\n   */\r\n\r\n  /**\r\n   * get children\r\n   * @param selector\r\n   * @param anyNode Boolean\r\n   * @return {*|HTMLElement}\r\n   */\r\n  children (selector, anyNode) {\r\n    // check arguments\r\n    if (typeof selector === 'boolean') {\r\n      anyNode = selector\r\n      selector = void 0\r\n    }\r\n\r\n    const children = []\r\n    let el\r\n    for (let i = 0; i < this.length; i++) {\r\n\r\n      const childNodes = this[i].childNodes\r\n\r\n      for (let j = 0; j < childNodes.length; j++) {\r\n        el = childNodes[j]\r\n        if (!selector) {\r\n          if (anyNode) {\r\n            children.push(el)\r\n          } else if (el.nodeType === 1) {\r\n            children.push(el)\r\n          }\r\n        } else if (el.nodeType === 1 && $(el).is(selector)) {\r\n          children.push(el)\r\n        }\r\n      }\r\n\r\n    }\r\n    return $(unique(children))\r\n  },\r\n\r\n  /**\r\n   * Find the nearest matching element in the parent\r\n   * @param selector\r\n   * @return {*}\r\n   */\r\n  closest (selector) {\r\n    let closest = this\r\n    if (typeof selector === 'undefined') {\r\n      return new $()\r\n    }\r\n    if (!closest.is(selector)) {\r\n      closest = closest.parents(selector).eq(0)\r\n    }\r\n    return closest\r\n  },\r\n\r\n  /**\r\n   * equal\r\n   * @param i\r\n   * @return {*|jQuery|HTMLElement}\r\n   */\r\n  eq (i) {\r\n    let len = this.length\r\n    let index = util.int(i) + (i < 0 ? len : 0)\r\n    return $(this[index])\r\n  },\r\n\r\n  /**\r\n   * find item\r\n   * @param selector\r\n   * @return {*|jQuery|HTMLElement}\r\n   */\r\n  find (selector) {\r\n    let found\r\n    let foundElements = []\r\n    for (let i = 0; i < this.length; i++) {\r\n      if (this[i].nodeType !== 1) continue\r\n      found = this[i].querySelectorAll(selector)\r\n      for (let j = 0; j < found.length; j++) {\r\n        foundElements.push(found[j])\r\n      }\r\n    }\r\n    return $(foundElements)\r\n  },\r\n\r\n  /**\r\n   *\r\n   * @param parent\r\n   * @return {*}\r\n   */\r\n  findParentFrom (parent) {\r\n    if (parent instanceof ZxQuery) parent = parent[0]\r\n    let current = this[0]\r\n    // if (!current || !current.nodeType || !parent || !parent.nodeType) return null\r\n    if (current === parent) return null\r\n    let tmpParent\r\n    while (current.parentNode) {\r\n      tmpParent = current.parentNode\r\n      if (tmpParent === parent) return $(current)\r\n      current = tmpParent\r\n    }\r\n    return null\r\n  },\r\n\r\n  /**\r\n   * get first child\r\n   * @return {*|jQuery|HTMLElement}\r\n   */\r\n  firstChild () {\r\n    return this.children().eq(0)\r\n  },\r\n\r\n  /**\r\n   * get last child\r\n   * @return {*|jQuery|HTMLElement}\r\n   */\r\n  lastChild () {\r\n    return this.children().eq(-1)\r\n  },\r\n\r\n  /**\r\n   * get next siblings\r\n   * @param selector\r\n   * @return {*|jQuery|HTMLElement}\r\n   */\r\n  next (selector) {\r\n    if (this.length > 0) {\r\n      if (selector) {\r\n        if (this[0].nextElementSibling && $(this[0].nextElementSibling).is(selector)) {\r\n          return $([this[0].nextElementSibling])\r\n        }\r\n        return $()\r\n      }\r\n\r\n      if (this[0].nextElementSibling) return $([this[0].nextElementSibling])\r\n    }\r\n    return $()\r\n  },\r\n\r\n  /**\r\n   * get nearest parents\r\n   * @param selector\r\n   * @return {*|jQuery|HTMLElement}\r\n   */\r\n  parent (selector) {\r\n    const parents = []\r\n    for (let i = 0; i < this.length; i++) {\r\n      if (this[i].parentNode !== null) {\r\n        if (selector) {\r\n          if ($(this[i].parentNode).is(selector)) parents.push(this[i].parentNode)\r\n        } else {\r\n          parents.push(this[i].parentNode)\r\n        }\r\n      }\r\n    }\r\n    return $(unique(parents))\r\n  },\r\n\r\n  /**\r\n   * get all parents\r\n   * @param selector\r\n   * @return {*|jQuery|HTMLElement}\r\n   */\r\n  parents (selector) {\r\n    const parents = []\r\n    for (let i = 0; i < this.length; i++) {\r\n      let parent = this[i].parentNode\r\n      while (parent) {\r\n        if (selector) {\r\n          if ($(parent).is(selector)) parents.push(parent)\r\n        } else {\r\n          parents.push(parent)\r\n        }\r\n        parent = parent.parentNode\r\n      }\r\n    }\r\n    return $(unique(parents))\r\n  },\r\n\r\n  /**\r\n   * ********************************************\r\n   * class\r\n   * ********************************************\r\n   */\r\n\r\n  /**\r\n   * add className\r\n   * @param className\r\n   * @return {ZxQuery}\r\n   */\r\n  addClass (className) {\r\n    if (!className) return this\r\n    let classes = className.split(' ')\r\n    classes.forEach(cls => {\r\n      for (let j = 0; j < this.length; j++) {\r\n        this[j] && this[j].classList && this[j].classList.add(cls)\r\n      }\r\n    })\r\n    return this\r\n  },\r\n\r\n  /**\r\n   * remove className\r\n   * @param className\r\n   * @return {ZxQuery}\r\n   */\r\n  removeClass (className) {\r\n    let classes = className.split(' ')\r\n    classes.forEach(cls => {\r\n      for (let j = 0; j < this.length; j++) {\r\n        this[j] && this[j].classList && this[j].classList.remove(cls)\r\n      }\r\n    })\r\n    return this\r\n  },\r\n\r\n  /**\r\n   * check className\r\n   * @param className\r\n   * @return {boolean}\r\n   */\r\n  hasClass (className) {\r\n    if (!this[0]) return false\r\n    return this[0].classList.contains(className)\r\n  },\r\n\r\n  /**\r\n   * ********************************************\r\n   * attribute, data\r\n   * ********************************************\r\n   */\r\n\r\n  /**\r\n   * get/set attribute\r\n   * @param attrs attribute or object\r\n   * @param value\r\n   * @return {*}\r\n   */\r\n  attr (attrs, value) {\r\n    if (arguments.length === 1 && typeof attrs === 'string') {\r\n      // Get attr\r\n      if (this[0]) return this[0].getAttribute(attrs)\r\n      return void 0\r\n    }\r\n\r\n    // Set attrs\r\n    for (let i = 0; i < this.length; i++) {\r\n      if (arguments.length === 2) {\r\n        // String\r\n        this[i].setAttribute(attrs, value)\r\n      } else {\r\n        // Object\r\n        for (let attr in attrs) {\r\n          this[i][attr] = attrs[attr]\r\n          this[i].setAttribute(attr, attrs[attr])\r\n        }\r\n      }\r\n    }\r\n    return this\r\n  },\r\n\r\n  /**\r\n   * remove attribute\r\n   * @param attr\r\n   * @return {ZxQuery}\r\n   */\r\n  removeAttr (attr) {\r\n    for (let i = 0; i < this.length; i++) {\r\n      this[i].removeAttribute(attr)\r\n    }\r\n    return this\r\n  },\r\n\r\n  /**\r\n   * get/set data-\r\n   * @param key\r\n   * @param value\r\n   * @return {*}\r\n   */\r\n  data (key, value) {\r\n    let el\r\n    if (typeof value === 'undefined') {\r\n      el = this[0]\r\n      if (el) {\r\n        if (el.dataStorage) return el.dataStorage[key]\r\n        let val = el.getAttribute(`data-${key}`)\r\n        return /^\\d+\\.?\\d*$/.test(val) ? +val : val\r\n      }\r\n      return undefined\r\n    }\r\n\r\n    // Set value\r\n    for (let i = 0; i < this.length; i++) {\r\n      el = this[i]\r\n      if (!el.dataStorage) el.dataStorage = {}\r\n      el.dataStorage[key] = value\r\n    }\r\n    return this\r\n  },\r\n\r\n  /**\r\n   * ********************************************\r\n   * insert node\r\n   * ********************************************\r\n   */\r\n\r\n  /**\r\n   * appendChild\r\n   * @param args\r\n   * @return {ZxQuery}\r\n   */\r\n  append (...args) {\r\n    let newChild\r\n\r\n    for (let k = 0; k < args.length; k++) {\r\n      newChild = args[k];\r\n      for (let i = 0; i < this.length; i++) {\r\n        if (typeof newChild === 'string') {\r\n          const tempDiv = document.createElement('div')\r\n          tempDiv.innerHTML = newChild\r\n          while (tempDiv.firstChild) {\r\n            this[i].appendChild(tempDiv.firstChild)\r\n          }\r\n        } else if (newChild instanceof ZxQuery) {\r\n          for (let j = 0; j < newChild.length; j++) {\r\n            this[i].appendChild(newChild[j])\r\n          }\r\n        } else {\r\n          this[i].appendChild(newChild)\r\n        }\r\n      }\r\n    }\r\n    return this\r\n  },\r\n\r\n  /**\r\n   * append child to parent\r\n   * @param parent\r\n   * @return {ZxQuery}\r\n   */\r\n  appendTo (parent) {\r\n    $(parent).append(this)\r\n    return this\r\n  },\r\n\r\n  /**\r\n   * insert after selector\r\n   * @param selector\r\n   */\r\n  insertAfter(selector) {\r\n    const after = $(selector)\r\n    for (let i = 0; i < this.length; i++) {\r\n      if (after.length === 1) {\r\n        after[0].parentNode.insertBefore(this[i], after[0].nextSibling)\r\n      } else if (after.length > 1) {\r\n        for (let j = 0; j < after.length; j++) {\r\n          after[j].parentNode.insertBefore(this[i].cloneNode(true), after[j].nextSibling)\r\n        }\r\n      }\r\n    }\r\n  },\r\n  insertBefore (selector) {\r\n    const before = $(selector)\r\n    for (let i = 0; i < this.length; i++) {\r\n      if (before.length === 1) {\r\n        before[0].parentNode.insertBefore(this[i], before[0])\r\n      } else if (before.length > 1) {\r\n        for (let j = 0; j < before.length; j++) {\r\n          before[j].parentNode.insertBefore(this[i].cloneNode(true), before[j])\r\n        }\r\n      }\r\n    }\r\n  },\r\n  prepend (newChild) {\r\n    let i\r\n    let j\r\n    for (i = 0; i < this.length; i++) {\r\n      if (typeof newChild === 'string') {\r\n        const tempDiv = document.createElement('div')\r\n        tempDiv.innerHTML = newChild\r\n        for (j = tempDiv.childNodes.length - 1; j >= 0; j--) {\r\n          this[i].insertBefore(tempDiv.childNodes[j], this[i].childNodes[0])\r\n        }\r\n      } else if (newChild instanceof ZxQuery) {\r\n        for (j = 0; j < newChild.length; j++) {\r\n          this[i].insertBefore(newChild[j], this[i].childNodes[0])\r\n        }\r\n      } else {\r\n        this[i].insertBefore(newChild, this[i].childNodes[0])\r\n      }\r\n    }\r\n    return this\r\n  },\r\n  prependTo (parent) {\r\n    $(parent).prepend(this)\r\n    return this\r\n  },\r\n\r\n  /**\r\n   * replace child\r\n   * @param selector\r\n   * @return {ZxQuery}\r\n   */\r\n  replace (selector) {\r\n    let newChild = $(selector)\r\n    let parentNode\r\n    for (let i = 0; i < this.length; i++) {\r\n      parentNode = this[i].parentNode\r\n      if (parentNode) {\r\n        parentNode.replaceChild(newChild[0].cloneNode(true), this[i])\r\n      }\r\n    }\r\n    return this\r\n  },\r\n\r\n  /**\r\n   * remove item\r\n   * @param index\r\n   * @return {ZxQuery}\r\n   */\r\n  remove (index) {\r\n    let el\r\n    if (typeof index !== 'number') {\r\n      for (let i = 0; i < this.length; i++) {\r\n        el = this[i]\r\n        if (el.parentNode) el.parentNode.removeChild(el)\r\n      }\r\n    } else {\r\n      el = this[index]\r\n      if (el && el.parentNode) el.parentNode.removeChild(el)\r\n    }\r\n    return this\r\n  },\r\n\r\n  /**\r\n   * ********************************************\r\n   * check\r\n   * ********************************************\r\n   */\r\n\r\n  /**\r\n   * is\r\n   * @param selector\r\n   * @return {*}\r\n   */\r\n  is (selector) {\r\n    const el = this[0]\r\n    let compareWith\r\n    let i\r\n    if (!el || typeof selector === 'undefined') return false;\r\n    if (typeof selector === 'string') {\r\n      if (el.matches) return el.matches(selector)\r\n      else if (el.webkitMatchesSelector) return el.webkitMatchesSelector(selector)\r\n      else if (el.msMatchesSelector) return el.msMatchesSelector(selector)\r\n\r\n      compareWith = $(selector)\r\n      for (i = 0; i < compareWith.length; i++) {\r\n        if (compareWith[i] === el) return true\r\n      }\r\n      return false\r\n    } else if (selector === document) return el === document\r\n    else if (selector === window) return el === window\r\n\r\n    if (selector.nodeType || selector instanceof ZxQuery) {\r\n      compareWith = selector.nodeType ? [selector] : selector\r\n      for (i = 0; i < compareWith.length; i++) {\r\n        if (compareWith[i] === el) return true\r\n      }\r\n      return false\r\n    }\r\n    return false\r\n  },\r\n\r\n  isTextNode () {\r\n    let el = this[0]\r\n    if (!el || !el.nodeType) return false\r\n    return el.nodeType === 3\r\n  },\r\n\r\n  /**\r\n   * 子元素（不包含br）是否为空\r\n   * @return {boolean}\r\n   */\r\n  isEmpty () {\r\n    return !util.strip(this.text()) && !this.find('img, video, audio')[0]\r\n  },\r\n\r\n  /**\r\n   * target是否为this的第一个子元素\r\n   * @param target\r\n   * @return {boolean}\r\n   */\r\n  isFirstChildren (target) {\r\n    return this.children().eq(0).is(target)\r\n  },\r\n\r\n  /**\r\n   * target是否为this的最后一个子元素\r\n   * @param target\r\n   * @return {boolean}\r\n   */\r\n  isLastChildren (target) {\r\n    return this.children().eq(-1).is(target)\r\n  },\r\n\r\n  indexOf(el) {\r\n    if (el instanceof ZxQuery) el = el[0]\r\n    for (let i = 0; i < this.length; i++) {\r\n      if (this[i] === el) return i\r\n    }\r\n    return -1\r\n  },\r\n\r\n  /**\r\n   * this is in $parent children\r\n   * @param $parent\r\n   * @return {boolean}\r\n   */\r\n  // isInChild ($parent) {\r\n  //   let el = this[0]\r\n  //   let childNodes = $parent[0].childNodes\r\n  //   let tmp\r\n  //   for (let i = 0; i < childNodes.length; i++) {\r\n  //     tmp = childNodes[i]\r\n  //     if (tmp === el) return true\r\n  //     if (tmp.nodeType === 1 && this.isInChild($(tmp))) return true\r\n  //   }\r\n  //   return false\r\n  // },\r\n\r\n  /**\r\n   * every\r\n   * @param fn\r\n   * @return {boolean}\r\n   */\r\n  every (fn) {\r\n    if (typeof fn !== 'function') throw new TypeError(`every(fn) fn is not a function`)\r\n    let len = this.length\r\n    let thisArg = arguments.length >= 2 ? arguments[1] : void 0\r\n    for (let i = 0; i < len; i++) {\r\n      if (fn.call(thisArg, $(this[i]), i)) return false\r\n    }\r\n    return true\r\n  },\r\n\r\n  /**\r\n   * ********************************************\r\n   * content\r\n   * ********************************************\r\n   */\r\n  text (text) {\r\n    if (typeof text === 'undefined') {\r\n      if (this[0]) {\r\n        return this[0].textContent.trim()\r\n      }\r\n      return ''\r\n    }\r\n\r\n    for (let i = 0; i < this.length; i++) {\r\n      this[i].textContent = text\r\n    }\r\n    return this\r\n  },\r\n\r\n  html (html) {\r\n    if (typeof html === 'undefined') {\r\n      return this[0] ? this[0].innerHTML : ''\r\n    }\r\n\r\n    for (let i = 0; i < this.length; i++) {\r\n      this[i].innerHTML = html\r\n    }\r\n    return this\r\n  },\r\n\r\n  /**\r\n   * ********************************************\r\n   * node\r\n   * ********************************************\r\n   */\r\n  nodeName () {\r\n    return this[0] ? this[0].nodeName.toLowerCase() : null\r\n  },\r\n\r\n  // https://developer.mozilla.org/en-US/docs/Web/API/Node/nodeType\r\n  nodeType () {\r\n    return this[0] ? this[0].nodeType : 0\r\n  },\r\n\r\n  changeNodeName (nodeName) {\r\n    for (let i = 0; i < this.length; i++) {\r\n      // change nodeName\r\n      this[i] = changeNodeName(this[i], nodeName)\r\n    }\r\n    return this\r\n  },\r\n  /**\r\n   * ********************************************\r\n   * visible\r\n   * ********************************************\r\n   */\r\n  hide () {\r\n    for (let i = 0; i < this.length; i++) {\r\n      this[i].style.display = 'none'\r\n    }\r\n    return this\r\n  },\r\n  show () {\r\n    for (let i = 0; i < this.length; i++) {\r\n      const el = this[i]\r\n      if (el.style.display === 'none') {\r\n        el.style.display = ''\r\n      }\r\n      if (window.getComputedStyle(el, null).getPropertyValue('display') === 'none') {\r\n        // Still not visible\r\n        el.style.display = 'block'\r\n      }\r\n    }\r\n    return this\r\n  },\r\n  /**\r\n   * ********************************************\r\n   * Events\r\n   * ********************************************\r\n   */\r\n  on (...args) {\r\n    let [eventType, fn, useCapture] = args\r\n    let el\r\n    for (let i = 0; i < this.length; i++) {\r\n      el = this[i]\r\n      if (el.nodeType === 1 || el === document || el === window) {\r\n        addEventListener(el, eventType, fn, useCapture)\r\n      }\r\n    }\r\n    return this\r\n  },\r\n  off(...args) {\r\n    let [eventType, fn, useCapture] = args\r\n    let el\r\n    for (let i = 0; i < this.length; i++) {\r\n      el = this[i]\r\n      if (el.nodeType === 1 || el === document || el === window) {\r\n        removeEventListener(el, eventType, fn, useCapture)\r\n      }\r\n    }\r\n    return this;\r\n  },\r\n  trigger(...args) {\r\n    const events = args[0].split(' ')\r\n    const eventData = args[1]\r\n    for (let i = 0; i < events.length; i++) {\r\n      const event = events[i]\r\n      for (let j = 0; j < this.length; j++) {\r\n        const el = this[j]\r\n        let evt\r\n        try {\r\n          evt = new window.CustomEvent(event, {\r\n            detail: eventData,\r\n            bubbles: true,\r\n            cancelable: true,\r\n          })\r\n        } catch (e) {\r\n          evt = document.createEvent('Event')\r\n          evt.initEvent(event, true, true)\r\n          evt.detail = eventData\r\n        }\r\n        el.dispatchEvent(evt)\r\n      }\r\n    }\r\n    return this\r\n  },\r\n  /**\r\n   * ********************************************\r\n   * css\r\n   * ********************************************\r\n   */\r\n  css(props, value) {\r\n    let i\r\n    if (arguments.length === 1) {\r\n      if (typeof props === 'string') {\r\n        if (this[0]) return window.getComputedStyle(this[0], null).getPropertyValue(props)\r\n        return void 0\r\n      } else {\r\n        for (i = 0; i < this.length; i += 1) {\r\n          for (let prop in props) {\r\n            this[i].style[prop] = props[prop]\r\n          }\r\n        }\r\n      }\r\n    }\r\n    if (arguments.length === 2 && typeof props === 'string') {\r\n      for (i = 0; i < this.length; i += 1) {\r\n        this[i].style[props] = value;\r\n      }\r\n    }\r\n    return this\r\n  },\r\n\r\n  styles() {\r\n    if (this[0]) return window.getComputedStyle(this[0], null)\r\n    return {}\r\n  },\r\n  /**\r\n   * ********************************************\r\n   * size\r\n   * ********************************************\r\n   */\r\n  width() {\r\n    if (this[0] === window) return window.innerWidth\r\n    return this.length > 0 ? parseFloat(this.css('width')) : null\r\n  },\r\n\r\n  outerWidth(includeMargins) {\r\n    if (this.length > 0) {\r\n      let offsetWidth = this[0].offsetWidth\r\n      if (includeMargins) {\r\n        const styles = this.styles()\r\n        return offsetWidth\r\n          + parseFloat(styles.getPropertyValue('margin-right'))\r\n          + parseFloat(styles.getPropertyValue('margin-left'))\r\n      }\r\n      return offsetWidth\r\n    }\r\n    return null\r\n  },\r\n\r\n  height() {\r\n    if (this[0] === window) return window.innerHeight\r\n    return this.length > 0 ? parseFloat(this.css('height')) : null\r\n  },\r\n\r\n  outerHeight(includeMargins) {\r\n    if (this.length > 0) {\r\n      let offsetHeight = this[0].offsetHeight\r\n      if (includeMargins) {\r\n        let styles = this.styles()\r\n        return offsetHeight\r\n          + parseFloat(styles.getPropertyValue('margin-top'))\r\n          + parseFloat(styles.getPropertyValue('margin-bottom'))\r\n      }\r\n      return offsetHeight\r\n    }\r\n    return null\r\n  },\r\n\r\n  offset () {\r\n    if (this.length > 0) {\r\n      let el = this[0]\r\n      let box = el.getBoundingClientRect()\r\n      let body = document.body\r\n      let clientTop = el.clientTop || body.clientTop || 0\r\n      let clientLeft = el.clientLeft || body.clientLeft || 0\r\n      let scrollTop = el === window ? window.scrollY : el.scrollTop\r\n      let scrollLeft = el === window ? window.scrollX : el.scrollLeft\r\n      return {\r\n        top: (box.top + scrollTop) - clientTop,\r\n        left: (box.left + scrollLeft) - clientLeft,\r\n      }\r\n    }\r\n    return null\r\n  },\r\n  /**\r\n   * ********************************************\r\n   * for\r\n   * ********************************************\r\n   */\r\n  each (fn) {\r\n    if (!fn) return this\r\n    for (let i = 0; i < this.length; i++) {\r\n      if (fn.call(this[i], i, this[i]) === false) {\r\n        return this\r\n      }\r\n    }\r\n    return this\r\n  },\r\n  /**\r\n   * ********************************************\r\n   * scroll\r\n   * ********************************************\r\n   */\r\n  scrollTop (value) {\r\n    if (!this.length) return\r\n    let hasScrollTop = 'scrollTop' in this[0]\r\n    if (value === undefined) return hasScrollTop ? this[0].scrollTop : this[0].pageYOffset\r\n    return this.each(hasScrollTop ?\r\n      function(){ this.scrollTop = value } :\r\n      function(){ this.scrollTo(this.scrollX, value) })\r\n  }\r\n}\r\n\r\nconst $ = function (selector, context) {\r\n  return new ZxQuery(selector, context)\r\n}\r\n\r\nexport default $\r\n","/**\r\n * Created by Capricorncd.\r\n * Date: 2019/04/15 13:14\r\n * Copyright © 2017-present, https://github.com/capricorncd\r\n */\r\nimport $, { ZxQuery } from '../dom-class/index'\r\n\r\n/**\r\n * Cursor Class\r\n * @param $parent\r\n * @constructor\r\n */\r\nfunction CursorClass ($parent) {\r\n  // Limit focus range\r\n  this.$parent = $parent\r\n  this.selection = null\r\n  this.range = null\r\n  this.currentNode = null\r\n  this.timer = null\r\n  let $el = $parent.lastChild()\r\n  // init offset\r\n  this.offset = $el.text().length || 0\r\n  if ($el[0]) this.setRange($el[0], this.offset)\r\n}\r\n\r\n/**\r\n * prototype\r\n * @type {{constructor: CursorClass, init(*=): void, setRange(*=, *=): void, getRange(): *}}\r\n */\r\nCursorClass.prototype = {\r\n  /**\r\n   * constructor\r\n   */\r\n  constructor: CursorClass,\r\n\r\n  init () {\r\n    this.selection = window.getSelection()\r\n    try {\r\n      this.range = this.selection.getRangeAt(0)\r\n    } catch (e) {\r\n      this.range = new Range()\r\n    }\r\n  },\r\n\r\n  /**\r\n   * 设置或创建光标位置\r\n   * @param el\r\n   * @param offset\r\n   */\r\n  setRange (el, offset) {\r\n    if (el instanceof ZxQuery) {\r\n      el = el[0]\r\n    }\r\n\r\n    if (this.selection === null) {\r\n      this.init()\r\n    } else {\r\n      // remove all range object\r\n      this.selection.removeAllRanges()\r\n    }\r\n\r\n    // 光标移动到到原来的位置加上新内容的长度\r\n    el = el || this.currentNode\r\n\r\n    if (el) {\r\n      // el: '<section>inner text.</section>'\r\n      let targetNode = el.childNodes[el.childNodes.length - 1] || el\r\n      // check img/video/audio\r\n      // console.log(targetNode.nodeName, this.offset)\r\n      if (/IMG|VIDEO|AUDIO/.test(targetNode.nodeName)) {\r\n        this.offset = 1\r\n        // get parentNode, can't set offset = 1 of IMG node.\r\n        targetNode = targetNode.parentNode\r\n      } else if (typeof offset === 'undefined') {\r\n        // get min offset, because offset cannot exceed the length of targetNode.textContent\r\n        this.offset = Math.min($(targetNode).text().length, this.offset)\r\n      } else {\r\n        this.offset = offset\r\n      }\r\n      this.range.setStart(targetNode, this.offset)\r\n      this.currentNode = el\r\n    }\r\n    // cursor start and end position is collapse\r\n    this.range.collapse(true)\r\n\r\n    if (this.timer) {\r\n      clearTimeout(this.timer)\r\n      this.timer = null\r\n    }\r\n    // 延时执行，键盘自动收起后再触发focus\r\n    this.timer = setTimeout(() => {\r\n      // 插入新的光标对象\r\n      this.selection.addRange(this.range)\r\n    }, 100)\r\n  },\r\n\r\n  /**\r\n   * get cursor node in $parent\r\n   * @param needElement Want to get element node, not ZxQuery object\r\n   * @return {*}\r\n   */\r\n  getCurrentNode (needElement) {\r\n    // 获取选定对象\r\n    // this.selection = window.getSelection()\r\n    // 设置最后光标对象\r\n    try {\r\n      this.range = this.selection.getRangeAt(0)\r\n    } catch (e) {\r\n      this.range = new Range()\r\n    }\r\n    this.currentNode = this.range.endContainer\r\n    this.offset = this.range.startOffset\r\n    // Check whether currentNode is in the this.$parent\r\n    let $currentNode = $(this.currentNode).findParentFrom(this.$parent)\r\n    let $current = $currentNode || this.$parent.lastChild()\r\n    return needElement ? $current[0] : $current\r\n  }\r\n}\r\n\r\nexport default CursorClass\r\n","/**\r\n * Created by Capricorncd.\r\n * User: https://github.com/capricorncd\r\n * Date: 2019/04/21 22:42\r\n */\r\nimport $ from '../dom-class'\r\nimport util from '../util'\r\nimport ZxEditor from '../index'\r\n\r\nconst fn = function () {}\r\n\r\nconst DEF_OPTS = {\r\n  head: null,\r\n  // className\r\n  className: '',\r\n  // head setup\r\n  headHeight: 44,\r\n  headLeftBtnClassName: '',\r\n  headLeftBtnText: '',\r\n  headTitle: 'Expansion Panel',\r\n  // height\r\n  height: 260,\r\n  // body内容\r\n  body: null,\r\n  // Used to distinguish ExpansionPanel instance\r\n  name: 'expansion-panel',\r\n  onHeadClick: fn,\r\n  onBodyClick: fn,\r\n  onBeforeShow: fn,\r\n  onShow: fn,\r\n  onBeforeHide: fn,\r\n  onHide: fn\r\n}\r\n\r\n/**\r\n * ExpansionPanel\r\n * Extension panel fixed at the bottom of the editor\r\n * @param options\r\n * @param zxEditor ZxEditor instance\r\n * @constructor\r\n */\r\nfunction ExpansionPanel (options, zxEditor) {\r\n  if (!zxEditor instanceof ZxEditor) {\r\n    throw new TypeError(`new ExpansionPanel() parameter error, arguments[1] is not a ZxEditor instance.`)\r\n  }\r\n\r\n  // options\r\n  let opts = this.options = Object.assign({}, DEF_OPTS, options)\r\n\r\n  // editor instance\r\n  this.editorInstance = zxEditor\r\n\r\n  zxEditor.expansionPanels.push(this)\r\n\r\n  // visible\r\n  this.visible = false\r\n\r\n  // Used to distinguish ExpansionPanel instance\r\n  this.name = opts.name\r\n\r\n  this.$body = $(`<div class=\"body-wrapper\" style=\"height:${opts.height - opts.headHeight}px;\"></div>`)\r\n\r\n  // node\r\n  this.$el = $(`<div class=\"zx-editor-expansion-panel border-top\"></div>`)\r\n\r\n  // click\r\n  // stop propagation\r\n  zxEditor.$eventHandlers[this.name] = {\r\n    $target: this.$el,\r\n    type: 'click',\r\n    handler: (e) => {\r\n      e.stopPropagation()\r\n    }\r\n  }\r\n  this.$el.on('click', zxEditor.$eventHandlers[this.name].handler)\r\n\r\n  if (opts.headHeight > 0) {\r\n    // custom head\r\n    if (opts.head) {\r\n      this.$head = $(opts.head)\r\n    } else {\r\n      // default head\r\n      this.$head = $(`<div class=\"head-wrapper border-bottom ${opts.headAlign}\" style=\"height:${opts.headHeight}px;line-height:${opts.headHeight}px;\"><div class=\"l cur ${opts.headLeftBtnClassName}\">${opts.headLeftBtnText}</div>${opts.headTitle || ''}</div>`)\r\n\r\n      // left btn\r\n      const $leftBtn = this.$head.find('.l')\r\n      zxEditor.$eventHandlers[this.name + 'HeadLeftBtn'] = {\r\n        $target: $leftBtn,\r\n        type: 'click',\r\n        handler: (e) => {\r\n          opts.onHeadClick.call(this, e, 'left-button')\r\n        }\r\n      }\r\n      $leftBtn.on('click', zxEditor.$eventHandlers[this.name + 'HeadLeftBtn'].handler)\r\n\r\n      const $switch = $(`<i class=\"switch\" style=\"width:${opts.headHeight}px;height:${opts.headHeight}px;\"></i>`)\r\n      this.$head.append($switch)\r\n      // switch event\r\n      zxEditor.$eventHandlers[this.name + 'HeadSwitch'] = {\r\n        $target: $switch,\r\n        type: 'click',\r\n        handler: (e) => {\r\n          opts.onHeadClick.call(this, e, 'switch')\r\n          this.hide()\r\n        }\r\n      }\r\n      $switch.on('click', zxEditor.$eventHandlers[this.name + 'HeadSwitch'].handler)\r\n    }\r\n\r\n    this.$el.append(this.$head)\r\n\r\n    this.$head.on('click', (e) => {\r\n      opts.onHeadClick.call(this, e)\r\n    })\r\n  }\r\n\r\n  // body\r\n  try {\r\n    this.$body.append($(opts.body))\r\n  } catch (e) {\r\n    throw e\r\n  }\r\n\r\n  this.$body.on('click', (e) => {\r\n    opts.onBodyClick.call(this, e)\r\n  })\r\n\r\n  this.$el.append(this.$body)\r\n\r\n  // append to $editor\r\n  zxEditor.$editor.append(this.$el)\r\n\r\n  // init\r\n  this.init(this.options)\r\n}\r\n\r\nExpansionPanel.prototype = {\r\n  /**\r\n   * constructor\r\n   */\r\n  constructor: ExpansionPanel,\r\n\r\n  /**\r\n   * init position\r\n   * Used to window.onresize\r\n   * @param options\r\n   */\r\n  init (options) {\r\n    options = options || this.options\r\n    let winHeight = window.innerHeight\r\n    this.$el.css({\r\n      height: `${options.height}px`,\r\n      top: winHeight + 'px'\r\n    })\r\n  },\r\n\r\n  /**\r\n   * show\r\n   */\r\n  show () {\r\n    if (!this.visible) {\r\n      this.options.onBeforeShow.call(this)\r\n      this.$el.removeClass('out').addClass('in')\r\n      this.visible = true\r\n      this.editorInstance.emit('expansionPanelShow', this, this.editorInstance)\r\n      this.options.onShow.call(this)\r\n    }\r\n  },\r\n\r\n  /**\r\n   * hide\r\n   */\r\n  hide () {\r\n    if (this.visible) {\r\n      this.options.onBeforeHide.call(this)\r\n      this.$el.removeClass('in').addClass('out')\r\n      this.visible = false\r\n      this.editorInstance.emit('expansionPanelHide', this, this.editorInstance)\r\n      this.options.onHide.call(this)\r\n    }\r\n  }\r\n}\r\n\r\nexport default ExpansionPanel\r\n","/**\r\n * Created by Capricorncd.\r\n * User: https://github.com/capricorncd\r\n * Date: 2019/04/29 21:08\r\n */\r\nimport { document } from 'ssr-window'\r\nimport $ from '../../dom-class/index'\r\n\r\nexport function changeTag (tag) {\r\n\r\n  // same tag\r\n  if (this.$cursorNode.nodeName() === tag) return\r\n\r\n  let cursorNode = this.$cursorNode[0]\r\n\r\n  let childNodes = cursorNode.childNodes\r\n\r\n  let len = childNodes.length\r\n\r\n  // to ul\r\n  if (tag === 'ul') {\r\n    let ul = document.createElement('ul')\r\n    cloneAttrs(ul, cursorNode)\r\n    for (let i = 0; i < len; i++) {\r\n      ul.appendChild(createLi(childNodes[i].cloneNode(true)))\r\n    }\r\n    cursorNode.parentNode.replaceChild(ul, cursorNode)\r\n    // save current node\r\n    this.$cursorNode = $(ul)\r\n    return\r\n  }\r\n\r\n  // change ul\r\n  if (cursorNode.nodeName === 'UL') {\r\n    let li, el\r\n    for (let i = 0; i < len; i++) {\r\n      li = childNodes[i].cloneNode(true)\r\n      cloneAttrs(li, cursorNode)\r\n      el = this.changeNodeName(li, tag)\r\n      $(el).insertBefore(this.$cursorNode)\r\n    }\r\n    // remove old ul\r\n    this.$cursorNode.remove()\r\n    this.$cursorNode = $(el)\r\n    return\r\n  }\r\n\r\n  this.$cursorNode.changeNodeName(tag)\r\n  this.cursor.setRange(this.$cursorNode)\r\n}\r\n\r\nfunction createLi (child) {\r\n  let li = document.createElement('li')\r\n  li.appendChild(child)\r\n  return li\r\n}\r\n\r\nfunction cloneAttrs (target, source) {\r\n  let style, id, className\r\n  style = source.getAttribute('style')\r\n  id = source.id\r\n  className = source.className\r\n  if (style) target.setAttribute('style', style)\r\n  if (id) target.id = id\r\n  if (className) target.className = className\r\n}\r\n","/**\r\n * Created by Capricorncd.\r\n * User: https://github.com/capricorncd\r\n * Date: 2019/04/21 10:33\r\n */\r\nexport const IPHONEX_BOTTOM_OFFSET_HEIGHT = 34\r\n","/**\n * Created by Capricorncd.\n * User: https://github.com/capricorncd\n * Date: 2019/04/27 21:11\n */\nimport $ from '../../dom-class'\nimport { createVdom } from '../../dom-class/helper'\nimport { changeTag } from './helper'\nimport { IPHONEX_BOTTOM_OFFSET_HEIGHT } from '../../config'\n\n// COLOR\nconst DEF_COLORS = [\n  '#333',\n  '#d0d0d0',\n  '#ff583d',\n  '#fdaa25',\n  '#44c67b',\n  '#14b2e0',\n  '#b065e2'\n]\n\n/**\n * create color vnode\n * @param colors\n * @return Object\n */\nfunction createColorVNode (colors) {\n  let arr = []\n  colors.forEach((color, i) => {\n    if (/^#\\w{3,6}$/.test(color)) {\n      arr.push({\n        tag: 'dd',\n        attrs: {\n          class: i === 0 ? 'active' : '',\n          'data-color': formatColorHexadecimal(color.toLowerCase())\n        },\n        child: [\n          {\n            tag: 'i',\n            attrs: {\n              style: `background:${color}`\n            }\n          }\n        ]\n      })\n    }\n  })\n  return arr\n}\n\nfunction formatColorHexadecimal (hex) {\n  let len = hex.length\n  return len === 7 ? hex : `#${hex[1]}${hex[1]}${hex[2]}${hex[2]}${hex[3]}${hex[3]}`\n}\n\n/**\n * text style panel\n * @param options\n * @return {{name: string, className: string, events: {type: string, handler: events.handler}}}\n */\nexport function styleExpansionPanel (options) {\n\n  const zxEditor = this\n\n  // dom structure\n  let panelBodyChild = []\n\n  let styleNode = {\n    tag: 'dl',\n    attrs: {\n      class: '__style-wrapper border-bottom'\n    },\n    child: [\n      {\n        tag: 'dd',\n        attrs: {\n          style: 'font-weight: 800;',\n          'data-style': 'fontWeight:800'\n        },\n        child: ['B']\n      },\n      {\n        tag: 'dd',\n        attrs: {\n          style: 'font-style: italic;',\n          'data-style': 'fontStyle:italic'\n        },\n        child: ['I']\n      },\n      {\n        tag: 'dd',\n        attrs: {\n          style: 'text-decoration: line-through;',\n          'data-style': 'textDecoration:line-through'\n        },\n        child: ['abc']\n      },\n      {\n        tag: 'dd',\n        attrs: {\n          style: '',\n          'data-style': 'textAlign:left',\n          class: 'text-align--l'\n        }\n      },\n      {\n        tag: 'dd',\n        attrs: {\n          style: '',\n          'data-style': 'textAlign:center',\n          class: 'text-align--c'\n        }\n      },\n      {\n        tag: 'dd',\n        attrs: {\n          style: '',\n          'data-style': 'textAlign:right',\n          class: 'text-align--r'\n        }\n      }\n    ]\n  }\n\n  panelBodyChild.push(styleNode)\n\n  const COLORS = Array.isArray(options.textStyleColors) ? options.textStyleColors : DEF_COLORS\n\n  if (COLORS.length) {\n    let colorsNode = {\n      tag: 'dl',\n      attrs: {\n        class: '__color-wrapper border-bottom'\n      },\n      child: createColorVNode(COLORS)\n    }\n    panelBodyChild.push(colorsNode)\n  }\n\n  let tagNode = {\n    tag: 'dl',\n    attrs: {\n      class: '__tag-wrapper'\n    },\n    child: [\n      {\n        tag: 'dd',\n        attrs: {\n          class: '__h2',\n          'data-tag': 'h2'\n        },\n        child: ['大标题', { tag: 'i' }]\n      },\n      {\n        tag: 'dd',\n        attrs: {\n          class: '__h4',\n          'data-tag': 'h4'\n        },\n        child: ['小标题', { tag: 'i' }]\n      },\n      {\n        tag: 'dd',\n        attrs: {\n          class: '__section active',\n          'data-tag': 'section'\n        },\n        child: ['正文', { tag: 'i' }]\n      },\n      {\n        tag: 'dd',\n        attrs: {\n          class: '__blockquote',\n          'data-tag': 'blockquote'\n        },\n        child: ['引用', { tag: 'i' }]\n      },\n      {\n        tag: 'dd',\n        attrs: {\n          class: '__ul',\n          'data-tag': 'ul'\n        },\n        child: ['无序列表', { tag: 'i' }]\n      }\n    ]\n  }\n\n  panelBodyChild.push(tagNode)\n\n\n  let panelBody = createVdom({\n    tag: 'div',\n    attrs: {\n      class: 'text-style-outer-wrapper'\n    },\n    child: panelBodyChild\n  })\n\n  let $panelBody = $(panelBody)\n\n  // instance text style\n  this.textStylePanel = new this.ExpansionPanel({\n    headLeftBtnText: options.textStyleHeadLeftBtnText,\n    headTitle: options.textStyleTitle,\n    headAlign: options.textStyleHeadAlign,\n    body: $panelBody,\n    onHeadClick: handleHeadClick\n  }, this)\n\n  // handle events\n  // style\n  const $styles = $panelBody.find('.__style-wrapper').children()\n  $styles.on('click', function () {\n    let style = $(this).data('style').split(':')\n    let key = style[0]\n    let cursorNode = zxEditor.$cursorNode[0]\n    cursorNode.style[key] = cursorNode.style[key] === style[1] ? '' : style[1]\n    zxEditor.cursor.setRange()\n  })\n\n  // color\n  const $colorsParent = $panelBody.find('.__color-wrapper')\n  const $colors = $colorsParent.children()\n  $colors.on('click', function () {\n    let $el\n    for (let i = 0; i < $colors.length; i++) {\n      $el = $($colors[i])\n      if ($el[0] === this && !$el.hasClass('active')) {\n        $el.addClass('active')\n        zxEditor.$cursorNode.css('color', $el.data('color'))\n      } else if ($el.hasClass('active')) {\n        $el.removeClass('active')\n      }\n    }\n    zxEditor.cursor.setRange()\n  })\n\n  // tag\n  const $tagsParent = $panelBody.find('.__tag-wrapper')\n  const $tags = $tagsParent.children()\n  $tags.on('click', function () {\n    if ($(this).hasClass('active')) return\n    let tag = $(this).data('tag')\n    let $el\n    for (let i = 0; i < $tags.length; i++) {\n      $el = $($tags[i])\n      if ($el[0] === this) {\n        // add active class name\n        $el.addClass('active')\n        // change tag\n        changeTag.call(zxEditor, tag)\n      } else if ($el.hasClass('active')) {\n        $el.removeClass('active')\n      }\n    }\n  })\n\n  if (this.isIPhoneX) {\n    $tagsParent.css('margin-bottom', IPHONEX_BOTTOM_OFFSET_HEIGHT + 'px')\n  }\n\n  // extend method\n  /**\n   * reset active state\n   * when content onClick and onKeyup code === 13\n   */\n  this.textStylePanel.resetActiveState = () => {\n    let $cursorNode = this.cursor.getCurrentNode()\n\n    // check tag\n    let tag = $cursorNode.nodeName()\n    setTagInPanel(tag)\n\n    // check color\n    let color = this.rgbToHex($cursorNode.css('color'))\n    setColorInPanel(color)\n  }\n\n  /**\n   * set tag in panel\n   * @param tag\n   */\n  function setTagInPanel (tag) {\n    let $activeTag = $tagsParent.find('.active')\n    if ($activeTag.data('tag') !== tag) {\n      $activeTag.removeClass('active')\n      $tagsParent.find(`.__${tag}`).addClass('active')\n    }\n  }\n\n  /**\n   * set color in panel\n   * @param color\n   */\n  function setColorInPanel (color) {\n    let $activeColor = $colorsParent.find('.active')\n    if ($activeColor.data('color') !== color) {\n\n      $activeColor.removeClass('active')\n\n      let $tmp\n      for (let i = 0; i < $colors.length; i++) {\n        $tmp = $($colors[i])\n        if ($tmp.data('color') === color) {\n          $tmp.addClass('active')\n          break\n        }\n      }\n    }\n  }\n\n  /**\n   * handle head click\n   * @param type\n   */\n  function handleHeadClick (type) {\n    // clear style\n    if (type === 'left-button') {\n      // clear style\n      let currentNode = zxEditor.$cursorNode[0]\n      currentNode.className = ''\n      currentNode.setAttribute('style', '')\n      if (currentNode.nodeName !== 'SECTION') {\n        zxEditor.$cursorNode = $(zxEditor.changeNodeName(currentNode, 'section'))\n      }\n      // reset text style expansion\n      setColorInPanel(COLORS[0])\n      setTagInPanel('section')\n      // set Range\n      zxEditor.cursor.setRange(zxEditor.$cursorNode)\n    }\n  }\n\n  return {\n    name: 'text-style',\n    className: 'text-style-btn',\n    events: {\n      type: 'click',\n      handler: () => {\n        this.textStylePanel.show()\n      }\n    }\n  }\n}\n","/**\r\n * Created by Capricorncd.\r\n * User: https://github.com/capricorncd\r\n * Date: 2019/05/04 00:09\r\n */\r\nimport { styleExpansionPanel } from './style-expansion-panel'\r\n\r\nexport function textStyle () {\r\n  this.toolbar.addButton(styleExpansionPanel.call(this, this.options))\r\n}\r\n","/**\r\n * Created by Capricorncd.\r\n * User: https://github.com/capricorncd\r\n * Date: 2019/04/27 21:19\r\n */\r\nimport $ from '../../dom-class/index'\r\n\r\nexport function selectPictureBtn () {\r\n  const _this = this\r\n  const options = this.options\r\n  /**\r\n   * *******************************************\r\n   * select picture\r\n   * image file handler\r\n   * *******************************************\r\n   */\r\n    // select picture\r\n  let $selectPictureLabel = $('<label class=\"toolbar-icon-pic\" style=\"position:absolute;top:0;left:0;width:100%;height:100%;\"></label>')\r\n  let $selectPictrueInput = $('<input type=\"file\" accept=\"image/*\" style=\"display:none\">')\r\n  $selectPictureLabel.append($selectPictrueInput)\r\n  let input = $selectPictrueInput[0]\r\n\r\n  // register selectPictureInputClick\r\n  this.$eventHandlers['selectPictureInputClick'] = {\r\n    $target: $selectPictrueInput,\r\n    type: 'click',\r\n    handler () {\r\n      input.value = ''\r\n    },\r\n    capture: false\r\n  }\r\n\r\n  // image section template\r\n  let imageSectionTemplate = /^<\\w+\\b.*<\\/\\w+>$/.test(options.imageSectionTemp) ? options.imageSectionTemp : `<section><img src=\"{url}\"></section>`\r\n\r\n  // register selectPictureInputChange\r\n  let imageOptions = Object.assign({}, _this.options, {\r\n    width: options.imageMaxWidth\r\n  })\r\n  this.$eventHandlers['selectPictureInputChange'] = {\r\n    $target: $selectPictrueInput,\r\n    type: 'change',\r\n    handler (e) {\r\n      let file = input.files[0]\r\n      _this.emit('selectPictureInputChange', file, e, _this)\r\n\r\n      // customize Picture Handler\r\n      if (options.customPictureHandler) return\r\n\r\n      // handler picture\r\n      _this.fileToBase64(file, imageOptions).then(res => {\r\n        // console.log(res)\r\n        let $el = $(imageSectionTemplate.replace('{url}', res.base64))\r\n        // set attribute\r\n        $el.find('img').attr({\r\n          id: 'zxEditor_img_' + (+new Date()),\r\n          alt: file.name\r\n        })\r\n        // insert to $content\r\n        _this.insertElm($el)\r\n      }).catch(e => {\r\n        _this.emit('error', e, 'fileToBase64')\r\n      })\r\n    },\r\n    capture: false\r\n  }\r\n\r\n  this.toolbar.addButton({\r\n    name: 'select-picture',\r\n    el: $selectPictureLabel\r\n  })\r\n}\r\n","/**\r\n * Created by Capricorncd.\r\n * User: https://github.com/capricorncd\r\n * Date: 2019/04/21 10:25\r\n */\r\nimport $ from '../dom-class'\r\nimport util from '../util'\r\nimport { window } from 'ssr-window'\r\nimport { IPHONEX_BOTTOM_OFFSET_HEIGHT } from '../config'\r\n\r\n// default button options\r\nconst DEF_BTN_OPTS = {\r\n  name: '',\r\n  // button className\r\n  className: '',\r\n  // ElementHTML or $()\r\n  el: null,\r\n  // innerHTML\r\n  innerHtml: '',\r\n  // style\r\n  style: '',\r\n  // obj{type: 'click', handler: fn, capture: false} or array[obj1, obj2]\r\n  events: null\r\n}\r\n\r\nfunction Toolbar (options, zxEditor) {\r\n  // zxEditor instance\r\n  this.editorInstance = zxEditor\r\n\r\n  // options\r\n  this.options = options\r\n\r\n  // visible\r\n  this.visible = options.toolbarBeenFixed\r\n\r\n  // create element\r\n  this.height = options.toolbarHeight\r\n  this.$el = $(`<div class=\"zx-editor-toolbar-wrapper border-top ${this.visible ? 'in' : 'out'}\" style=\"height:${this.height + (util.isIPhoneX ? IPHONEX_BOTTOM_OFFSET_HEIGHT : 0)}px;\"><dl class=\"inner-wrapper\" style=\"height:${this.height}px;\"></dl></div>`)\r\n\r\n  // append to $editor\r\n  zxEditor.$editor.append(this.$el)\r\n\r\n  // init\r\n  this.init(options)\r\n}\r\n\r\nToolbar.prototype = {\r\n  /**\r\n   * constructor\r\n   */\r\n  constructor: Toolbar,\r\n\r\n  /**\r\n   * Used to window.onresize\r\n   * @param options\r\n   */\r\n  init (options) {\r\n    options = options || this.options\r\n    let winHeight = window.innerHeight\r\n    this.$el.css({\r\n      top: winHeight + 'px'\r\n    })\r\n    if (this.visible) this.editorInstance.emit('toolbarShow', this, this.editorInstance)\r\n  },\r\n\r\n  /**\r\n   * show\r\n   */\r\n  show () {\r\n    if (!this.visible) {\r\n      // change className\r\n      this.$el.removeClass('out').addClass('in')\r\n      this.visible = true\r\n      this.editorInstance.emit('toolbarShow', this, this.editorInstance)\r\n    }\r\n  },\r\n\r\n  /**\r\n   * hide\r\n   */\r\n  hide () {\r\n    if (this.visible) {\r\n      // change className\r\n      this.$el.removeClass('in').addClass('out')\r\n      this.visible = false\r\n      this.editorInstance.emit('toolbarHide', this, this.editorInstance)\r\n    }\r\n  },\r\n\r\n  /**\r\n   * add button\r\n   * @param opts\r\n   * @param index Insert index\r\n   */\r\n  addButton (opts, index) {\r\n    // params\r\n    let params = Object.assign({}, DEF_BTN_OPTS, opts)\r\n\r\n    // name\r\n    if (!params.name) params.name = 'toolbar-btn-' + (+new Date())\r\n\r\n    // create $node\r\n    let $btn = $(`<dd class=\"icon-item\" data-name=\"${params.name}\" style=\"${params.style}\"></dd>`)\r\n    // handle el\r\n    if (params.el && typeof params.el === 'object') {\r\n      $btn.append($(params.el))\r\n    } else {\r\n      // handle innerHtml\r\n      $btn.html(params.innerHtml)\r\n    }\r\n\r\n    // className\r\n    if (params.className) {\r\n      $btn.addClass(params.className)\r\n    }\r\n\r\n    // style\r\n    let css = {}\r\n    if (this.options.toolbarHeight) {\r\n      css.width = css.height = this.options.toolbarHeight + 'px'\r\n    }\r\n    $btn.css(css)\r\n\r\n    // insert to document\r\n    let $btns = this.$el.find('.inner-wrapper').children()\r\n\r\n    if (typeof index === 'number' && index < $btns.length) {\r\n      $btn.insertBefore($btns[index])\r\n    } else {\r\n      this.$el.find('.inner-wrapper').append($btn)\r\n    }\r\n\r\n    // events\r\n    if (params.events) {\r\n      let events\r\n      if (util.isObject(params.events)) {\r\n        events = []\r\n        events.push(params.events)\r\n      } else if (Array.isArray(params.events)) {\r\n        events = params.events\r\n      }\r\n      // register events\r\n      let eventHandlerKey\r\n      const $eventHandlers = this.editorInstance.$eventHandlers\r\n      events.forEach(item => {\r\n        if (item && typeof item.type === 'string' && typeof item.handler === 'function') {\r\n          eventHandlerKey = `toolbarBtnEvent_${item.name}`\r\n          $eventHandlers[eventHandlerKey] = {\r\n            $target: $btn,\r\n            type: item.type,\r\n            handler: item.handler.bind(this.editorInstance),\r\n            capture: typeof item.capture === 'boolean' ? item.capture : false\r\n          }\r\n          $btn.on(item.type, $eventHandlers[eventHandlerKey].handler, $eventHandlers[eventHandlerKey].capture)\r\n        } else {\r\n          throw new TypeError(`Function addButton(opts), opts.events's parameter error.`)\r\n        }\r\n      })\r\n    }\r\n  }\r\n}\r\n\r\nexport default Toolbar\r\n","/**\r\n * Created by Capricorncd.\r\n * User: https://github.com/capricorncd\r\n * Date: 2019/04/15 21:52\r\n */\r\nimport util from '../util'\r\n\r\n/**\r\n * 获取剪切文本内容\r\n * @param e event\r\n * @return {Promise<any>}\r\n */\r\nexport function getPasteText (e) {\r\n  return new Promise(resolve => {\r\n    let clipboardData = e.clipboardData\r\n    let pasteStr = ''\r\n    if (!clipboardData) {\r\n      resolve('')\r\n      return\r\n    }\r\n    let items = clipboardData.items\r\n    // console.log(e)\r\n    // console.log(clipboardData)\r\n    // console.log(items)\r\n    if (items && items.length > 0) {\r\n      let len = items.length\r\n      let count = 0\r\n      let i, item\r\n      for (i = 0; i < len; i++) {\r\n        item = items[i]\r\n        // 获取文本内容\r\n        if (/^text\\/plain/.test(item.type)) {\r\n          item.getAsString(str => {\r\n            pasteStr += str\r\n            counter(count, len)\r\n          })\r\n        } else {\r\n          counter(count, len)\r\n        }\r\n      }\r\n    } else {\r\n      resolve('')\r\n    }\r\n\r\n    /**\r\n     * 计数\r\n     * @param count\r\n     * @param len\r\n     */\r\n    function counter(count, len) {\r\n      count++\r\n      if (count === len) resolve(util.strip(pasteStr))\r\n    }\r\n  })\r\n}\r\n","/**\r\n * Create by capricorncd\r\n * 2018/5/30 0030.\r\n */\r\n/**\r\n * on\r\n * @param notifyName\r\n * @param fn\r\n */\r\nfunction on (notifyName, fn) {\r\n  if (!notifyName\r\n    || typeof notifyName !== 'string'\r\n    || !fn\r\n    || typeof fn !== 'function') return\r\n  if (!this.customEvents[notifyName]) {\r\n    this.customEvents[notifyName] = []\r\n  }\r\n  this.customEvents[notifyName].push(fn)\r\n}\r\n\r\n/**\r\n * emit\r\n * @param notifyName\r\n */\r\nfunction emit (notifyName) {\r\n  let notifyArr = this.customEvents[notifyName]\r\n  if (!notifyArr) return\r\n  let args = Array.prototype.slice.call(arguments, 1)\r\n  for (let i = 0; i < notifyArr.length; i++) {\r\n    try {\r\n      notifyArr[i].apply(null, args)\r\n    } catch (e) {\r\n      this.emit('error', e, 'emit')\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * off\r\n * @param notifyName\r\n */\r\nfunction off (notifyName, fn) {\r\n  if (this.customEvents[notifyName]) {\r\n    if (typeof fn === 'function' && this.customEvents[notifyName]) {\r\n      let index = this.customEvents[notifyName].findIndex(item => item === fn)\r\n      if (index >= 0) this.customEvents[notifyName].splice(index, 1)\r\n    } else {\r\n      this.customEvents[notifyName] = null\r\n      delete this.customEvents[notifyName]\r\n    }\r\n  }\r\n}\r\n\r\nexport {\r\n  on,\r\n  emit,\r\n  off\r\n}\r\n","/**\r\n * Created by Capricorncd.\r\n * User: https://github.com/capricorncd\r\n * Date: 2019/04/24 21:37\r\n */\r\nimport { document } from 'ssr-window'\r\nimport util from \"../util\";\r\n\r\nexport function getImageInfo (base64, file, opts, callback) {\r\n  let img = document.createElement('img')\r\n  img.src = base64\r\n  img.setAttribute('alt', file.name)\r\n  // 加载图片\r\n  img.onload = function () {\r\n    let defaultData = {\r\n      element: img,\r\n      base64,\r\n      width: img.naturalWidth || img.width,\r\n      height: img.naturalHeight || img.height,\r\n      type: file.type,\r\n      size: file.size,\r\n      name: file.name,\r\n      file\r\n    }\r\n    callback(null, opts.orientation > 1 ? rotateAndToBase64(defaultData, opts.orientation) : defaultData)\r\n  }\r\n\r\n  img.onerror = callback\r\n}\r\n\r\n/**\r\n * Decide whether the picture is rotated or not according to 'opts.orientation' value\r\n * @param raw\r\n * @param type\r\n * @returns {Object}\r\n */\r\nfunction rotateAndToBase64 (raw, orientation) {\r\n  let canvas = document.createElement('canvas')\r\n  let ctx = canvas.getContext('2d')\r\n  let img = raw.element\r\n  let imgWidth = raw.width\r\n  let imgHeight = raw.height\r\n  canvas.width = imgWidth\r\n  canvas.height = imgHeight\r\n  // rotate image\r\n  switch(orientation) {\r\n    // 90deg\r\n    case 6:\r\n      canvas.width = imgHeight\r\n      canvas.height = imgWidth\r\n      ctx.rotate(Math.PI / 2)\r\n      // (0, -imgHeight)\r\n      ctx.drawImage(img, 0, -imgHeight, imgWidth, imgHeight)\r\n      break\r\n    // 180deg\r\n    case 3:\r\n      ctx.rotate(Math.PI)\r\n      ctx.drawImage(img, -imgWidth, -imgHeight, imgWidth, imgHeight)\r\n      break;\r\n    // -90(270)deg\r\n    case 8:\r\n      canvas.width = imgHeight\r\n      canvas.height = imgWidth\r\n      ctx.rotate(3 * Math.PI / 2)\r\n      ctx.drawImage(img, -imgWidth, 0, imgWidth, imgHeight)\r\n      break\r\n    default:\r\n      ctx.drawImage(img, 0, 0, imgWidth, imgHeight)\r\n  }\r\n  let base64 = canvas.toDataURL(raw.type)\r\n  img.src = base64\r\n\r\n  return Object.assign(raw, {\r\n    element: canvas,\r\n    base64,\r\n    width: canvas.width,\r\n    height: canvas.height\r\n  })\r\n}\r\n\r\n/**\r\n * 创建Canvas\r\n * @param el Image object or Canvas element\r\n * @param p clip options\r\n * @returns {Element}\r\n */\r\nexport function createCanvas (el, p) {\r\n  const canvas = document.createElement('canvas')\r\n  canvas.width = p.cw\r\n  canvas.height = p.ch\r\n  const ctx = canvas.getContext('2d')\r\n  // 操作过于频繁，iPhone部分手机会获取不到ctx，is null\r\n  // 下面代码会抛出异常\r\n  ctx.drawImage(el, p.sx, p.sy, p.sw, p.sh, 0, 0, canvas.width, canvas.height)\r\n  return canvas\r\n}\r\n\r\n/**\r\n * 缩放比列\r\n * @param {Number} numerator\r\n * @param {Number} denominator\r\n */\r\nfunction ratio (numerator, denominator) {\r\n  return parseInt(numerator / denominator * 10000) / 10000\r\n}\r\n\r\n/**\r\n * Calculate the position and size of the generated image clipping\r\n * @param {Number} iw // image width\r\n * @param {Number} ih // image height\r\n * @param {Object} opts\r\n */\r\nexport function computeCropInfo (iw, ih, opts) {\r\n  // target image width, height\r\n  let targetWidth = util.int(opts.width)\r\n  let targetHeight = util.int(opts.height)\r\n\r\n  // image width or height, less than target width or height\r\n  // don't resize\r\n  if (!opts.forceImageResize && (targetWidth > 0 && iw < targetWidth)\r\n    && (targetHeight > 0 && ih < targetHeight)) {\r\n    return {\r\n      sx: 0,\r\n      sy: 0,\r\n      sw: iw,\r\n      sh: ih,\r\n      scaling: 1,\r\n      cw: iw,\r\n      ch: ih\r\n    }\r\n  }\r\n\r\n  // scaling\r\n  let scaling = 1\r\n\r\n  // Pictures begin to crop in x, y coordinates\r\n  let sx = 0\r\n  let sy = 0\r\n  // canvas\r\n  let canvasWidth = iw\r\n  let canvasHieght = ih\r\n  // Picture Size after Equal Ratio Scaling\r\n  let sw = 0\r\n  let sh = 0\r\n\r\n  // Scale to the right size, then cut in the middle\r\n  if (targetWidth > 0 && targetHeight > 0) {\r\n    // The size of canvas is to set the size for cutting\r\n    canvasWidth = targetWidth\r\n    canvasHieght = targetHeight\r\n\r\n    // Adjust the size of the picture according to the target width: the width of the picture equals the width of the clipping frame\r\n    sw = targetWidth\r\n    sh = Math.floor(targetWidth * ih / iw)\r\n\r\n    scaling = ratio(iw, targetWidth)\r\n\r\n    // Picture height beyond the clipping box, can be normal clipping\r\n    if (sh >= targetHeight) {\r\n      sx = 0\r\n      sy = util.int((sh - targetHeight) / 2 * scaling)\r\n    }\r\n    // To satisfy the clipping requirement, we need to resize: image height === clipping frame height\r\n    else {\r\n      scaling = ratio(ih, targetHeight)\r\n      sw = Math.floor(targetHeight * iw / ih)\r\n      sh = targetHeight\r\n      sx = util.int((sw - targetWidth) / 2 * scaling)\r\n      sy = 0\r\n    }\r\n\r\n  }\r\n  // Zoom Picture Code **********************************\r\n  // Only width is set\r\n  else if (targetWidth > 0) {\r\n    scaling = ratio(iw, targetWidth)\r\n    canvasWidth = targetWidth\r\n    canvasHieght = Math.floor(targetWidth * ih / iw)\r\n  }\r\n  // Only height is set\r\n  else if (targetHeight > 0) {\r\n    scaling = ratio(ih, targetHeight)\r\n    canvasWidth = Math.floor(targetHeight * iw / ih)\r\n    canvasHieght = targetHeight\r\n  }\r\n\r\n  return {\r\n    sx: sx,\r\n    sy: sy,\r\n    sw: util.int(canvasWidth * scaling),\r\n    sh: util.int(canvasHieght * scaling),\r\n    scaling: scaling,\r\n    cw: canvasWidth,\r\n    ch: canvasHieght\r\n  }\r\n}\r\n","/**\r\n * Created by Capricorncd.\r\n * User: https://github.com/capricorncd\r\n * Date: 2019/04/24 21:13\r\n */\r\nimport { window } from 'ssr-window'\r\nimport { getImageInfo, computeCropInfo, createCanvas } from './helper'\r\n\r\nconst DEF_OPTIONS = {\r\n  width: 0,\r\n  heigth: 0,\r\n  imageMaxSize: null,\r\n  ignoreGif: true,\r\n  forceResize: false\r\n}\r\n\r\n/**\r\n * base64 data to Blob\r\n * @param base64Data\r\n * @return {Blob}\r\n */\r\nfunction base64ToBlobData (base64Data) {\r\n  // base64数据格式:\r\n  // \"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEASABIAAD/2wBDAAkGB+wgHBgkIBwgKCgkLDRYPDQw//9k=\"\r\n  let type, onlyData\r\n  if (/^data:(\\w+\\/\\w+);base64,(.+)/.test(base64Data)) {\r\n    type = RegExp.$1\r\n    onlyData = RegExp.$2\r\n  } else {\r\n    throw new TypeError(`base64ToBlobData(base64Data), base64Data non-base64 data!`)\r\n  }\r\n\r\n  let data = window.atob(onlyData)\r\n  let ia = new Uint8Array(data.length)\r\n  for (let i = 0; i < data.length; i++) {\r\n    ia[i] = data.charCodeAt(i)\r\n  }\r\n  return new Blob([ia], {type: type})\r\n}\r\n\r\n/**\r\n * file to base64 data\r\n * @param file\r\n * @param opts\r\n * @return {Promise<any>}\r\n */\r\nfunction fileToBase64 (file, opts) {\r\n  return new Promise((resolve, reject) => {\r\n    if (!file || !file instanceof File) {\r\n      throw new TypeError(`file is not a File object`)\r\n    }\r\n\r\n    let options = Object.assign({}, DEF_OPTIONS, opts)\r\n\r\n    // check file type\r\n    if (!/image\\/.*/i.test(file.type)) {\r\n      reject(new TypeError(`\"${file.name}\" is not Image File!`))\r\n      return\r\n    }\r\n\r\n    // rotate image\r\n    if (typeof window.EXIF === 'undefined') {\r\n      options.orientation = 0\r\n      handleFile(file, options).then(resolve).catch(reject)\r\n    } else {\r\n      window.EXIF.getData(file, function () {\r\n        let info = window.EXIF.getAllTags(this) || {}\r\n        // Shooting direction\r\n        options.orientation = info.Orientation\r\n        handleFile(file, options).then(resolve).catch(reject)\r\n      })\r\n    }\r\n  })\r\n}\r\n\r\n/**\r\n * to blob url\r\n * @param blob Blob数据\r\n * @returns {*}\r\n */\r\nfunction blobToUrl (blob) {\r\n  return window.URL.createObjectURL(blob)\r\n}\r\n\r\nfunction handleFile (file, opts) {\r\n  return new Promise((resolve, reject) => {\r\n    const reader = new FileReader()\r\n    reader.readAsDataURL(file)\r\n    reader.onload = function () {\r\n      // get image info\r\n      getImageInfo(this.result, file, opts, (e, raw) => {\r\n        if (e) {\r\n          reject(e)\r\n          return\r\n        }\r\n        // check gif\r\n        if (file.type === 'image/gif' && opts.ignoreGif) {\r\n          raw.data = file\r\n          raw.url = blobToUrl(file)\r\n          raw.raw = raw\r\n          resolve(raw)\r\n          return\r\n        }\r\n        let result = handleImageData(raw, opts)\r\n        // check file size\r\n        if (opts.imageMaxSize > 0 && result.size / 1024 > opts.imageMaxSize) {\r\n          reject(new RangeError(`File size \"${result.size / 1024}\" out of range, limit is ${opts.imageMaxSize}Kib`))\r\n          return\r\n        }\r\n        resolve(result)\r\n      })\r\n    }\r\n\r\n    reader.onerror = reject\r\n  })\r\n}\r\n\r\n/**\r\n * Processing picture data, clipping and compression\r\n * @param raw\r\n * @param opts\r\n * @private\r\n */\r\nfunction handleImageData (raw, opts) {\r\n  // file type\r\n  let dataType = raw.type || raw.file.type\r\n\r\n  // Calculate the position and size of zooming or clipping pictures\r\n  let res = computeCropInfo(raw.width, raw.height, opts)\r\n\r\n  // image or canvas\r\n  let el = raw.element\r\n\r\n  let scaling = 2\r\n  let sw = res.sw\r\n  let sh = res.sh\r\n  let sx = res.sx\r\n  let sy = res.sy\r\n\r\n  if (res.scaling > scaling) {\r\n    scaling = res.scaling\r\n    while (scaling > 2) {\r\n      el = createCanvas(el, {\r\n        cw: res.cw * scaling,\r\n        ch: res.ch * scaling,\r\n        sx: sx,\r\n        sy: sy,\r\n        sw: sw,\r\n        sh: sh\r\n      })\r\n      sw = el.width\r\n      sh = el.height\r\n      sx = sy = 0\r\n      scaling -= 1\r\n    }\r\n  }\r\n  el = createCanvas(el, {\r\n    cw: res.cw,\r\n    ch: res.ch,\r\n    sx: sx,\r\n    sy: sy,\r\n    sw: sw,\r\n    sh: sh\r\n  })\r\n\r\n  let base64 = el.toDataURL(dataType)\r\n  let blob = base64ToBlobData(base64)\r\n\r\n  return {\r\n    element: el,\r\n    type: dataType,\r\n    width: res.cw,\r\n    height: res.ch,\r\n    data: blob,\r\n    base64,\r\n    size: blob.size,\r\n    url: blobToUrl(blob),\r\n    // 原始图片数据\r\n    raw\r\n  }\r\n}\r\n\r\nexport {\r\n  fileToBase64,\r\n  blobToUrl,\r\n  base64ToBlobData\r\n}\r\n","/**\n * Created by Capricorncd.\n * Date: 2019/04/12 11:12\n * Copyright © 2017-present, https://github.com/capricorncd\n */\n/**\n * ***********************************************\n * Notes:\n * 1. The property or variables prefixed $ are ZxQuery instance, or related to them\n * ***********************************************\n */\nimport $ from './dom-class/index'\nimport CursorClass from './cursor-class/index'\nimport ExpansionPanel from './expansion-panel/index'\nimport util from './util/index'\nimport { initDom } from './init/init-dom'\nimport { initStyle } from './init/init-style'\nimport { handleEvents } from './events/index'\nimport { extendPrototypes } from './init/extend-prototype'\nimport { base64ToBlobData } from './image-handler/index'\n\nconst DEF_OPTIONS = {\n  // 内容是否可以被编辑\n  editable: true,\n  // 编辑器输入内容绝对定位\n  fixed: false,\n  // editor min height\n  // minHeight: window.innerHeight,\n  // style\n  placeholder: 'Enter...',\n  placeholderColor: '',\n  lineHeight: 1.5,\n  // paragraph tail spacing, default 10px\n  paragraphTailSpacing: '',\n  cursorColor: '',\n  textColor: '',\n  // iphone会自动移动，难控制\n  cursorOffsetTop: 30,\n  // 自定义粘贴处理\n  customPasteHandler: false,\n  /**\n   * ******************************\n   * toolbar options\n   * ******************************\n   */\n  // Has the toolbar been fixed?\n  toolbarBeenFixed: true,\n  toolbarHeight: 50,\n  // buttons name, and order\n  toolbarBtns: ['select-picture', 'text-style'],\n  /**\n   * ******************************\n   * image options\n   * ******************************\n   */\n  // customize Picture Handler\n  customPictureHandler: false,\n  // image max width\n  imageMaxWidth: 720,\n  // image max size, unit Kib, default 20M\n  imageMaxSize: 20480,\n  // template\n  imageSectionTemp: `<section class=\"child-is-picture\"><img src=\"{url}\"></section>`,\n  // GIF pictures are not processed\n  ignoreGif: true,\n  // Force the width/height of the picture, even if the width/height of the picture\n  // is smaller than the target width/height\n  forceImageResize: false,\n  /**\n   * ******************************\n   * text style options\n   * ******************************\n   */\n  // text style, value ['#333', '#f00', ...]\n  textStyleColors: null,\n  textStyleTitle: 'Set Style',\n  textStyleHeadLeftBtnText: 'Clear style',\n  textStyleHeadAlign: 'center',\n  /**\n   * ******************************\n   * color options\n   * ******************************\n   */\n  mainColor: '',\n  // border color\n  borderColor: ''\n}\n\nfunction ZxEditor (selector, _options) {\n  if (!this instanceof ZxEditor) {\n    throw new Error('ZxEditor is a constructor and should be called with the `new` keyword')\n  }\n  /**\n   * ***************************************************\n   * check selector\n   * ***************************************************\n   */\n  this.$wrapper = $(selector)\n\n  if (!this.$wrapper[0]) {\n    throw new Error(`Can't found '${selector}' Node in document!`)\n  }\n\n  // version\n  this.version = '__VERSION__'\n\n  // ZxQuery instance\n  this.$ = $\n\n  this.ExpansionPanel = ExpansionPanel\n\n  // options\n  this.options = Object.assign(DEF_OPTIONS, _options)\n  this.init(this.options)\n}\n\nZxEditor.prototype = {\n\n  constructor: ZxEditor,\n\n  init (options) {\n    options = options || this.options\n\n    /**\n     * ***************************************************\n     * event listeners\n     * or expansionPanel instance\n     * ***************************************************\n     */\n    // $().on, $().off, $().trigger\n    this.$eventHandlers = {}\n    // this.on, this.off, this.emit\n    this.customEvents = {}\n    // extend prototype\n    extendPrototypes(ZxEditor)\n    // expansionPanel instances\n    this.expansionPanels = []\n\n    /**\n     * ***************************************************\n     * create dom\n     * ***************************************************\n     */\n    initDom.call(this, options)\n\n    /**\n     * ***************************************************\n     * style and placeholder\n     * ***************************************************\n     */\n    initStyle.call(this, options)\n\n    /**\n     * ***************************************************\n     * cursor\n     * ***************************************************\n     */\n    this.cursor = new CursorClass(this.$content)\n\n    this.$cursorNode = this.cursor.getCurrentNode()\n\n    /**\n     * ***************************************************\n     * event: last\n     * ***************************************************\n     */\n    handleEvents.call(this)\n  },\n  /**\n   * 插入元素或字符串\n   * @param el\n   */\n  insertElm (el) {\n    // string\n    if (!el) return\n    // 光标元素及偏移量\n    let $cursorNode = this.$cursorNode\n\n    let newRangeEl, newRangeOffset\n    /**\n     * string\n     */\n    if (typeof el === 'string') {\n      // 光标所在元素内容为空\n      if ($cursorNode.isEmpty()) {\n        $cursorNode.text(el)\n        newRangeEl = $cursorNode\n        newRangeOffset = el.length\n      } else if ($cursorNode.children().every($item => $item.isTextNode())) {\n        let rangeOffset = this.cursor.offset\n        let rangeNodeStr = $cursorNode.text()\n        let tmpStr = rangeNodeStr.substr(0, rangeOffset) + el + rangeNodeStr.substr(rangeOffset)\n        // $section = $cursorNode.closest('section')\n        $cursorNode.text(tmpStr)\n        newRangeEl = $cursorNode\n        newRangeOffset = el.length + rangeOffset\n      } else {\n        // 创建一个section\n        let $newEl = $(`<section>${el}</section>`)\n        // 插入到childIndex后\n        $newEl.insertAfter($cursorNode)\n        newRangeEl = $newEl\n        newRangeOffset = el.length\n      }\n    }\n    /**\n     * 插入元素为：非文本\n     */\n    else {\n      let $el = $(el)\n      let $elm\n      for (let i = 0; i < $el.length; i++) {\n        $elm = $($el[i])\n        let nodeName = $elm.nodeName()\n        // SECTION\n        if (nodeName !== 'section') {\n          if ($elm.nodeType() === 1 && !/video|img|audio/.test(nodeName)) {\n            $elm.changeNodeName('section')\n          } else {\n            let $tmp = $(`<section></section>`)\n            $elm = $tmp.append($elm)\n          }\n        }\n        if ($cursorNode.isEmpty()) {\n          // siblings is empty\n          if ($cursorNode.next()[0] && $cursorNode.next().isEmpty()) {\n            $cursorNode.replace($elm)\n          } else {\n            $elm.insertBefore($cursorNode)\n          }\n        } else {\n          $elm.insertAfter($cursorNode)\n        }\n        // 判断$el是否有下一个节点，有：光标指向el结束，无：则插入空行，并移动光标\n        let next = $elm.next()[0]\n        if (next) {\n          newRangeEl = $elm\n          newRangeOffset = $elm.isTextNode() ? $elm.text().length : 0\n        } else {\n          let $section = $(`<section><br></section>`)\n          this.$content.append($section)\n          newRangeEl = $section\n          newRangeOffset = 0\n        }\n      }\n    }\n    this._checkChildSection()\n    this.$content.trigger('input')\n    console.log(newRangeEl, newRangeOffset)\n    this.cursor.setRange(newRangeEl, newRangeOffset)\n  },\n\n  /**\n   * 插入空行\n   */\n  insertBlankLine () {\n    let $el = $(`<section><br></section>`)\n    this.insertElm($el)\n    this.cursor.setRange($el, 0)\n  },\n\n  /**\n   * 检查内容是否为空\n   * @private\n   */\n  _checkEmpty () {\n    let $el = this.$content\n    if ($el.isEmpty()) {\n      $el.addClass('is-empty')\n    } else if ($el.hasClass('is-empty')) {\n      $el.removeClass('is-empty')\n    }\n  },\n\n  /**\n   * 检查一级子元素，nodeName是否为(SECTION|H1|H2|H3|H4|BLOCKQUOTE|UL)\n   * 否：则替换为section标签，或者放入section标签内\n   * @private\n   */\n  _checkChildSection () {\n    if (!this.$cursorNode) this.$cursorNode = this.cursor.getCurrentNode()\n    let cursorNode = this.$cursorNode[0]\n    let isCursorNode = false\n    const parent = this.$content[0]\n    let childNodes = parent.childNodes\n    let el\n    for (let i = 0; i < childNodes.length; i++) {\n      el = childNodes[i]\n      if (el.nodeType === 1) {\n        if (!/SECTION|H1|H2|H3|H4|BLOCKQUOTE|UL/.test(el.nodeName)) {\n          isCursorNode = el === cursorNode\n          el = util.changeNodeName(el, 'section')\n          if (isCursorNode) {\n            this.$cursorNode = $(el)\n            this.cursor.setRange(el)\n          }\n        }\n      } else {\n        let $tmp = $(`<section></section>`)\n        $tmp.append(el.cloneNode())\n        parent.replaceChild($tmp[0], el)\n        this.$cursorNode = $tmp\n        this.cursor.setRange($tmp)\n      }\n    }\n  },\n\n  /**\n   * 清空内容\n   */\n  remove () {\n    this.setHtml()\n  },\n\n  /**\n   * 设置编辑器内容\n   * @param html\n   */\n  setHtml (html) {\n    this.$content.html(html || '<section><br></section>')\n    this._checkChildSection()\n    this.cursor.setRange(this.$content.firstChild(), 0)\n    this.$content.trigger('input')\n  },\n\n  /**\n   * 获取编辑器html内容\n   * 返回html内容\n   * @return {*}\n   */\n  getHtml () {\n    return this.$content.html()\n  },\n\n  /**\n   * 获取编辑器文本内容，\n   * 以纯文本形式返回数据\n   * @return {*|string}\n   */\n  getText () {\n    return this.$content.text()\n  },\n\n  /**\n   * destroy event and Node\n   */\n  destroy (){\n    let evt\n    // remove $events\n    for (let key in this.$eventHandlers) {\n      evt = this.$eventHandlers[key]\n      evt.$target.off(evt.type, evt.handler, evt.capture)\n      delete this.$eventHandlers[key]\n    }\n\n    // remove customEvents\n    for (let key in this.customEvents) {\n      evt = this.customEvents[key]\n      this.off(key)\n    }\n\n    // other object\n    this.cursor = null\n    this.toolbar = null\n    this.textStylePanel = null\n\n    // other ExpansionPanel\n    for (let key in this) {\n      if (this[key] instanceof ExpansionPanel) {\n        this[key] = null\n      }\n    }\n\n    // Node\n    this.$editor.remove()\n  },\n\n  /**\n   * set content height\n   * default minHeight is window innerHeight, marginBottom\n   * @param data\n   */\n  setContentHeight (data) {\n    let winHeight = window.innerHeight\n    let styles = {\n      // 防止正文内容被键盘挡住，无法查看\n      marginBottom: winHeight + 'px'\n    }\n    // check height\n    if (data.height) {\n      styles.height = typeof data.height === 'number' ? (data.height + 'px') : data.height\n    } else {\n      styles.minHeight = (util.int(data.minHeight) || winHeight) + 'px'\n    }\n\n    this.$content.css(styles)\n  },\n\n  /**\n   * get base64 images from this.$content\n   * @returns {Array}\n   */\n  getBase64Images () {\n    const arr = []\n    const $imgs = this.$content.find('img')\n    let img, base64\n    for (let i = 0; i < $imgs.length; i++) {\n      img = $imgs[i]\n      base64 = img.src\n      if (/^data:.+?;base64,/.test(base64)) {\n        arr.push({\n          id: img.id,\n          base64: base64,\n          blob: base64ToBlobData(base64)\n        })\n      }\n    }\n    return arr\n  },\n\n  /**\n   * 设置指定id图片src\n   * @param id\n   * @param src\n   * @returns {boolean}\n   */\n  setImageSrc (id, src) {\n    let img = this.$content.find('#' + id)[0]\n    if (img) {\n      img.src = src\n      img.removeAttribute('id')\n      return true\n    }\n    return false\n  },\n\n  /**\n   * plugin\n   * @param fn\n   */\n  plugin (fn) {\n    if (typeof fn === 'function') {\n      fn.call(this)\n    }\n  },\n\n  /**\n   * check cursor position\n   */\n  checkPosition () {\n    const $el = this.$cursorNode = this.cursor.getCurrentNode()\n    // 当前光标位置\n    let cursorOffset = this.cursor.offset\n    // 文本内容长度\n    let len = $el.text().length\n    // 当前元素高度\n    let height = $el.height()\n    // 当前元素top\n    let top = $el.offset().top\n    let scrollTop\n\n    // 当前光标位置，距当前元素顶部距离\n    let cursorHeight = 0\n\n    // 每行大概有几个字\n    let textNumOfPerLine = len / (height / this.lineHeight)\n    // 当前光标所在行\n    let line = height > this.lineHeight ? Math.floor(cursorOffset / textNumOfPerLine) : 1\n    // 当前光标位置，至当前元素顶部高度 - 1行高，防止移动后，光标位置太贴近顶部\n    let cursorHeightInCurrentNode = (line - 1) * this.lineHeight\n\n    // editor postion: fixed;\n    if (this.options.fixed) {\n\n    } else {\n      // 当前光标位置超过了屏幕的4分之1\n      if (cursorHeightInCurrentNode > window.innerHeight / 4) {\n        cursorHeight = cursorHeightInCurrentNode\n      }\n      scrollTop = $(window).scrollTop()\n      $(window).scrollTop(scrollTop + top + cursorHeight - this.options.cursorOffsetTop)\n    }\n  }\n}\n\nexport default ZxEditor\n","/**\r\n * Created by Capricorncd.\r\n * User: https://github.com/capricorncd\r\n * Date: 2019/04/16 20:28\r\n */\r\nimport { emit, off, on } from '../custom-events'\r\nimport { getPasteText } from '../events/paste'\r\nimport { base64ToBlobData, blobToUrl, fileToBase64 } from '../image-handler/index'\r\nimport util from '../util/index'\r\nimport { createElement, createVdom } from '../dom-class/helper'\r\n\r\nexport function extendPrototypes (ZxEditor) {\r\n  // custom events\r\n  ZxEditor.prototype.on = on\r\n  ZxEditor.prototype.emit = emit\r\n  ZxEditor.prototype.off = off\r\n  // static method\r\n  ZxEditor.prototype.getPasteText = getPasteText\r\n  // static utils\r\n  for (let key in util) {\r\n    if (util.hasOwnProperty(key)) {\r\n      ZxEditor.prototype[key] = util[key]\r\n    }\r\n  }\r\n  ZxEditor.prototype.blobToUrl = blobToUrl\r\n  ZxEditor.prototype.base64ToBlobData = base64ToBlobData\r\n  ZxEditor.prototype.fileToBase64 = fileToBase64\r\n  // dom\r\n  ZxEditor.prototype.createElement = createElement\r\n  ZxEditor.prototype.createVdom = createVdom\r\n}\r\n","/**\r\n * Created by Capricorncd.\r\n * User: https://github.com/capricorncd\r\n * Date: 2019/04/15 21:49\r\n */\r\nimport $ from '../dom-class'\r\nimport util from '../util/index'\r\nimport { textStyle } from '../plugins/text-style/index'\r\nimport { selectPictureBtn } from '../plugins/select-picture-btn/index'\r\nimport Toolbar from '../toolbar'\r\n\r\nexport function initDom (options) {\r\n  // content\r\n  this.$content = $(`<div class=\"zx-editor-content-wrapper is-empty\" contenteditable=\"${options.editable}\"><section><br></section></div>`)\r\n\r\n  this.setContentHeight(options)\r\n\r\n  // editor\r\n  this.$editor = $(`<div class=\"zx-editor\"></div>`)\r\n\r\n  // append to $eidtor\r\n  this.$editor.append(this.$content)\r\n\r\n  // toolbar\r\n  this.toolbar = new Toolbar(options, this)\r\n\r\n  // append to $wrapper\r\n  this.$wrapper.append(this.$editor)\r\n\r\n  // get lineHeight\r\n  this.lineHeight = util.int(this.$content.styles().lineHeight)\r\n\r\n  // plugin\r\n  // sort btn\r\n  options.toolbarBtns.forEach(name => {\r\n    if (name === 'select-picture') {\r\n      this.plugin(selectPictureBtn)\r\n    } else if (name === 'text-style') {\r\n      this.plugin(textStyle)\r\n    }\r\n  })\r\n}\r\n","/**\r\n * Created by Capricorncd.\r\n * User: https://github.com/capricorncd\r\n * Date: 2019/04/15 21:46\r\n */\r\nimport $ from '../dom-class'\r\n\r\nexport function initStyle (options) {\r\n  /**\r\n   * *****************************************\r\n   * append style\r\n   * *****************************************\r\n   */\r\n  // main color\r\n  let style = `.zx-editor .m-color{color:${options.mainColor} !important;}.zx-editor .text-style-outer-wrapper .__tag-wrapper dd i {border-color:${options.mainColor} !important;}`\r\n\r\n  // line-height, caret-color\r\n  if (options.lineHeight || options.cursorColor || options.textColor) {\r\n    let lineHeight = options.lineHeight ? `line-height:${options.lineHeight};` : ''\r\n    let caretColor = options.cursorColor ? `caret-color:${options.cursorColor};` : ''\r\n    let textColor = options.textColor ? `color:${options.textColor};` : ''\r\n    style += `.zx-editor .zx-editor-content-wrapper{${lineHeight + caretColor + textColor}}`\r\n  }\r\n  if (options.paragraphTailSpacing) {\r\n    style += `.zx-editor .zx-editor-content-wrapper > *{margin-bottom:${options.paragraphTailSpacing};}`\r\n  }\r\n  // placeholder\r\n  if (options.placeholder || options.placeholderColor) {\r\n    let content = options.placeholder ? `content:'${options.placeholder}';` : ''\r\n    let color = options.placeholderColor ? `color:${options.placeholderColor};` : ''\r\n    style += `.zx-editor .zx-editor-content-wrapper.is-empty:before{${content + color}}`\r\n  }\r\n  if (options.borderColor) {\r\n    style += `.zx-editor .border-top:before, .zx-editor .border-bottom:after {border-color: ${options.borderColor}`\r\n  }\r\n\r\n  /**\r\n   * *****************************************\r\n   * editor $content\r\n   * *****************************************\r\n   */\r\n  $('head').append(`<style type=\"text/css\">${style}</style>`)\r\n}\r\n","/**\r\n * Created by Capricorncd.\r\n * User: https://github.com/capricorncd\r\n * Date: 2019/04/15 21:53\r\n */\r\nimport $ from '../dom-class'\r\nimport { window } from 'ssr-window'\r\nimport util from '../util'\r\nimport { getPasteText } from './paste'\r\n\r\n/**\r\n * handle events\r\n */\r\nexport function handleEvents () {\r\n\r\n  const $content = this.$content\r\n\r\n  const $window = $(window)\r\n\r\n  const options = this.options\r\n\r\n  /**\r\n   * ****************************************************\r\n   * window on resize\r\n   * ****************************************************\r\n   */\r\n  function windowResize (e) {\r\n    this.emit('windowResize', e, this)\r\n    // toolbar\r\n    this.toolbar.init()\r\n    // expansion panels\r\n    this.expansionPanels.forEach(item => {\r\n      item.init()\r\n    })\r\n  }\r\n\r\n  this.$eventHandlers.windowResize = {\r\n    $target: $window,\r\n    type: 'resize',\r\n    handler: windowResize.bind(this)\r\n  }\r\n\r\n  /**\r\n   * ****************************************************\r\n   * content on paste\r\n   * ****************************************************\r\n   */\r\n  function contentPaste (e) {\r\n    this.emit('paste', e, this)\r\n    if (!options.customPasteHandler) {\r\n      e.preventDefault()\r\n      getPasteText(e).then(str => {\r\n        // 添加至焦点处\r\n        this.insertElm(util.removeHtmlTags(str))\r\n      })\r\n    }\r\n  }\r\n\r\n  this.$eventHandlers.contentPaste = {\r\n    $target: $content,\r\n    type: 'paste',\r\n    handler: contentPaste.bind(this)\r\n  }\r\n\r\n  /**\r\n   * ****************************************************\r\n   * content on input\r\n   * ****************************************************\r\n   */\r\n  function contentInput (e) {\r\n    this.emit('input', e, this)\r\n    // check empty in content\r\n    this._checkEmpty()\r\n\r\n    // check cursor node position\r\n    this.checkPosition()\r\n\r\n    // emit content on change\r\n    this.emit('change', e, this)\r\n  }\r\n\r\n  this.$eventHandlers.contentInput = {\r\n    $target: $content,\r\n    type: 'input',\r\n    handler: contentInput.bind(this)\r\n  }\r\n\r\n  /**\r\n   * ****************************************************\r\n   * content on focus\r\n   * ****************************************************\r\n   */\r\n  function contentFocus (e) {\r\n    this.emit('focus', e, this)\r\n    // console.error('contentFocus')\r\n    // hide all expansionPanels\r\n    // this.expansionPanels.forEach(ep => {\r\n    //   ep.hide()\r\n    // })\r\n    // toolbar\r\n    if (!this.options.toolbarBeenFixed) {\r\n      this.toolbar.show()\r\n    }\r\n  }\r\n\r\n  this.$eventHandlers.contentFocus = {\r\n    $target: $content,\r\n    type: 'focus',\r\n    handler: contentFocus.bind(this)\r\n  }\r\n\r\n  /**\r\n   * ****************************************************\r\n   * content on blur\r\n   * ****************************************************\r\n   */\r\n  function contentBlur (e) {\r\n    this.emit('blur', e, this)\r\n    // save $cursorNode\r\n    this.$cursorNode = this.cursor.getCurrentNode()\r\n\r\n    this._checkChildSection()\r\n    // console.warn(this.$cursorNode[0])\r\n    // toolbar\r\n    if (!this.options.toolbarBeenFixed) {\r\n      this.toolbar.hide()\r\n    }\r\n  }\r\n\r\n  this.$eventHandlers.contentBlur = {\r\n    $target: $content,\r\n    type: 'blur',\r\n    handler: contentBlur.bind(this)\r\n  }\r\n\r\n  /**\r\n   * ****************************************************\r\n   * content on click\r\n   * ****************************************************\r\n   */\r\n  function contentClick (e) {\r\n    this.emit('click', e, this)\r\n    // save $cursorNode\r\n    this.$cursorNode = this.cursor.getCurrentNode()\r\n    // check position\r\n    this.checkPosition()\r\n    // textStylePanel is undefined, or is hide\r\n    if (!this.textStylePanel || !this.textStylePanel.visible) return\r\n    this.textStylePanel.resetActiveState()\r\n  }\r\n\r\n  this.$eventHandlers.contentClick = {\r\n    $target: $content,\r\n    type: 'click',\r\n    handler: contentClick.bind(this)\r\n  }\r\n\r\n\r\n  /**\r\n   * ****************************************************\r\n   * content on keydown\r\n   * ****************************************************\r\n   */\r\n  function contentKeydown (e) {\r\n    this.emit('keydown', e, this)\r\n  }\r\n\r\n  this.$eventHandlers.contentKeyup = {\r\n    $target: $content,\r\n    type: 'keydown',\r\n    handler: contentKeydown.bind(this)\r\n  }\r\n\r\n  /**\r\n   * ****************************************************\r\n   * content on keyup\r\n   * ****************************************************\r\n   */\r\n  function contentKeyup (e) {\r\n    this.emit('keyup', e, this)\r\n    // handle enter keyup\r\n    if (e.key === 'Enter' || e.keyCode === 13) {\r\n      // check section node\r\n      this._checkChildSection()\r\n      // content on click\r\n      contentClick.call(this)\r\n    }\r\n    // check position\r\n    // this.checkPosition()\r\n  }\r\n\r\n  this.$eventHandlers.contentKeyup = {\r\n    $target: $content,\r\n    type: 'keyup',\r\n    handler: contentKeyup.bind(this)\r\n  }\r\n\r\n  /**\r\n   * ****************************************************\r\n   * register events\r\n   * ****************************************************\r\n   */\r\n  let evt\r\n  for (let key in this.$eventHandlers) {\r\n    evt = this.$eventHandlers[key]\r\n    evt.$target.on(evt.type, evt.handler, evt.capture)\r\n  }\r\n}\r\n"],"names":["doc","document","body","addEventListener","removeEventListener","activeElement","blur","nodeName","querySelector","querySelectorAll","getElementById","createEvent","initEvent","createElement","children","childNodes","style","setAttribute","getElementsByTagName","location","hash","win","window","navigator","userAgent","history","CustomEvent","this","getComputedStyle","getPropertyValue","Image","Date","screen","setTimeout","clearTimeout","unique","arr","uniqueArray","i","length","indexOf","push","changeNodeName","oldNode","tagName","oldNodeName","toLowerCase","util","strip","TypeError","el","nodeType","appendChild","className","id","getAttribute","innerHTML","parentNode","replaceChild","createTextNode","str","tag","attrs","_typeof","key","hasOwnProperty","createVdom","vnode","child","itemNode","Array","isArray","forEach","item","regTrim","USER_AGENT","PLATFORM","platform","int","n","num","parseInt","isNaN","trim","toString","replace","isObject","obj","isAbsolute","isObj","toHex","hex","isIPhone","test","isIPhoneX","height","width","supportBoxModel","div","paddingLeft","result","offsetWidth","removeChild","isElement","isWindow","removeHtmlTags","rgbToHex","rgb","RegExp","$1","$2","$3","slice","ArrayLike","index","call","toHump","match","toUpperCase","ZxQuery","selector","context","doms","tempDiv","every","_this","prototype","constructor","anyNode","j","$","is","closest","parents","eq","len","find","found","foundElements","findParentFrom","parent","tmpParent","current","firstChild","lastChild","next","nextElementSibling","addClass","split","cls","_this2","classList","add","removeClass","_this3","remove","hasClass","contains","attr","value","arguments","removeAttr","removeAttribute","data","dataStorage","val","append","newChild","k","appendTo","insertAfter","after","insertBefore","nextSibling","cloneNode","before","prepend","prependTo","compareWith","matches","webkitMatchesSelector","msMatchesSelector","isTextNode","isEmpty","text","isFirstChildren","target","isLastChildren","fn","thisArg","textContent","html","hide","display","show","on","args","eventType","useCapture","attachEvent","off","detachEvent","trigger","events","eventData","event","evt","detail","bubbles","cancelable","e","dispatchEvent","css","props","prop","styles","innerWidth","parseFloat","outerWidth","includeMargins","innerHeight","outerHeight","offsetHeight","offset","box","getBoundingClientRect","clientTop","clientLeft","scrollTop","scrollY","scrollLeft","scrollX","top","left","each","hasScrollTop","undefined","pageYOffset","scrollTo","CursorClass","$parent","selection","range","currentNode","timer","$el","setRange","init","getSelection","getRangeAt","Range","removeAllRanges","targetNode","Math","min","setStart","collapse","addRange","getCurrentNode","needElement","endContainer","startOffset","$current","DEF_OPTS","head","headHeight","headLeftBtnClassName","headLeftBtnText","headTitle","name","onHeadClick","onBodyClick","onBeforeShow","onShow","onBeforeHide","onHide","ExpansionPanel","options","zxEditor","ZxEditor","opts","Object","assign","editorInstance","expansionPanels","visible","$body","$eventHandlers","$target","type","handler","stopPropagation","$head","headAlign","$leftBtn","$switch","$editor","changeTag","$cursorNode","cursorNode","ul","cloneAttrs","createLi","li","cursor","source","winHeight","emit","IPHONEX_BOTTOM_OFFSET_HEIGHT","DEF_COLORS","textStyle","toolbar","addButton","panelBodyChild","COLORS","textStyleColors","colorsNode","colors","color","formatColorHexadecimal","createColorVNode","panelBody","$panelBody","textStylePanel","textStyleHeadLeftBtnText","textStyleTitle","textStyleHeadAlign","setColorInPanel","setTagInPanel","$colorsParent","$colors","$tagsParent","$tags","$activeTag","$activeColor","$tmp","resetActiveState","selectPictureBtn","$selectPictureLabel","$selectPictrueInput","input","capture","imageSectionTemplate","imageSectionTemp","imageOptions","imageMaxWidth","file","files","customPictureHandler","fileToBase64","then","res","base64","alt","insertElm","DEF_BTN_OPTS","innerHtml","Toolbar","toolbarBeenFixed","toolbarHeight","getPasteText","Promise","resolve","clipboardData","pasteStr","items","getAsString","counter","count","notifyName","customEvents","notifyArr","apply","findIndex","splice","getImageInfo","callback","img","src","onload","defaultData","element","naturalWidth","naturalHeight","size","orientation","raw","canvas","ctx","getContext","imgWidth","imgHeight","rotate","PI","drawImage","toDataURL","rotateAndToBase64","onerror","createCanvas","p","cw","ch","sx","sy","sw","sh","ratio","numerator","denominator","DEF_OPTIONS","heigth","imageMaxSize","ignoreGif","forceResize","params","$btn","$btns","eventHandlerKey","bind","base64ToBlobData","base64Data","onlyData","atob","ia","Uint8Array","charCodeAt","Blob","reject","File","EXIF","handleFile","getData","info","getAllTags","Orientation","blobToUrl","blob","URL","createObjectURL","reader","FileReader","readAsDataURL","url","dataType","iw","ih","targetWidth","targetHeight","forceImageResize","scaling","canvasWidth","canvasHieght","floor","computeCropInfo","handleImageData","RangeError","editable","fixed","placeholder","placeholderColor","lineHeight","paragraphTailSpacing","cursorColor","textColor","cursorOffsetTop","customPasteHandler","toolbarBtns","mainColor","borderColor","_options","Error","$wrapper","version","extendPrototypes","$content","setContentHeight","plugin","caretColor","content","$window","contentClick","checkPosition","windowResize","contentPaste","preventDefault","contentInput","_checkEmpty","contentFocus","contentBlur","_checkChildSection","contentKeyup","keyCode","newRangeEl","newRangeOffset","$item","rangeOffset","rangeNodeStr","tmpStr","substr","$newEl","$elm","$section","console","log","insertBlankLine","isCursorNode","setHtml","getHtml","getText","destroy","marginBottom","minHeight","getBase64Images","$imgs","setImageSrc","cursorOffset","cursorHeight","textNumOfPerLine","cursorHeightInCurrentNode"],"mappings":"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"}
